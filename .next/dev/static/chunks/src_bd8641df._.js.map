{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\n// ‚úÖ A√±ade esta verificaci√≥n\r\nconsole.log(\"Supabase URL:\", supabaseUrl);\r\nconsole.log(\"Supabase Key:\", supabaseAnonKey);\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  throw new Error('Missing Supabase environment variables');\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN,4BAA4B;AAC5B,QAAQ,GAAG,CAAC,iBAAiB;AAC7B,QAAQ,GAAG,CAAC,iBAAiB;AAE7B;;AAIO,MAAM,WAAW,IAAA,iMAAY,EAAC,aAAa"}},
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/notifications.ts"],"sourcesContent":["// src/lib/notifications.ts\r\nimport { supabase } from './supabaseClient';\r\n\r\ninterface NotificationData {\r\n  type: 'invitation_received' | 'invitation_accepted' | 'invitation_rejected' | 'photo_uploaded' | 'message_received' | 'connection_established' | 'profile_updated';\r\n  userId: string;\r\n  organizationId: string;\r\n  title: string;\r\n  message: string;\r\n  relatedId?: string;  // ‚Üê A√ëADIR este campo\r\n  data?: any;\r\n}\r\n\r\n/**\r\n * Enviar una notificaci√≥n a un usuario\r\n */\r\nexport async function sendNotification({\r\n  type,\r\n  userId,\r\n  organizationId,\r\n  title,\r\n  message,\r\n  relatedId,  // ‚Üê A√ëADIR este par√°metro\r\n  data = {}\r\n}: NotificationData) {\r\n  try {\r\n    const { error } = await supabase\r\n      .from('notifications')\r\n      .insert({\r\n        user_id: userId,\r\n        organization_id: organizationId,\r\n        type,\r\n        title,\r\n        message,\r\n        related_id: relatedId,  // ‚Üê GUARDAR related_id en la base de datos\r\n        data\r\n      });\r\n\r\n    if (error) {\r\n      console.error('Error sending notification:', error);\r\n      throw error;\r\n    }\r\n\r\n    console.log('Notification sent successfully');\r\n  } catch (error) {\r\n    console.error('Failed to send notification:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de invitaci√≥n recibida\r\n */\r\nexport async function sendInvitationReceivedNotification(\r\n  recipientUserId: string,\r\n  recipientOrgId: string,\r\n  senderOrgName: string,\r\n  invitationId?: string  // ‚Üê A√ëADIR este par√°metro opcional\r\n) {\r\n  await sendNotification({\r\n    type: 'invitation_received',\r\n    userId: recipientUserId,\r\n    organizationId: recipientOrgId,\r\n    title: 'Nueva invitaci√≥n',\r\n    message: `${senderOrgName} te ha enviado una invitaci√≥n para conectarse.`,\r\n    relatedId: invitationId,  // ‚Üê PASAR invitationId como related_id\r\n    data: { senderOrgName }\r\n  });\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de invitaci√≥n aceptada\r\n */\r\nexport async function sendInvitationAcceptedNotification(\r\n  senderUserId: string,\r\n  senderOrgId: string,\r\n  recipientOrgName: string\r\n) {\r\n  await sendNotification({\r\n    type: 'invitation_accepted',\r\n    userId: senderUserId,\r\n    organizationId: senderOrgId,\r\n    title: 'Invitaci√≥n aceptada',\r\n    message: `${recipientOrgName} ha aceptado tu invitaci√≥n.`,\r\n    data: { recipientOrgName }\r\n  });\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de invitaci√≥n rechazada\r\n */\r\nexport async function sendInvitationRejectedNotification(\r\n  senderUserId: string,\r\n  senderOrgId: string,\r\n  recipientOrgName: string\r\n) {\r\n  await sendNotification({\r\n    type: 'invitation_rejected',\r\n    userId: senderUserId,\r\n    organizationId: senderOrgId,\r\n    title: 'Invitaci√≥n rechazada',\r\n    message: `${recipientOrgName} ha rechazado tu invitaci√≥n.`,\r\n    data: { recipientOrgName }\r\n  });\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de foto subida\r\n */\r\nexport async function sendPhotoUploadedNotification(\r\n  recipientUserId: string,\r\n  recipientOrgId: string,\r\n  senderOrgName: string,\r\n  photoTitle: string\r\n) {\r\n  await sendNotification({\r\n    type: 'photo_uploaded',\r\n    userId: recipientUserId,\r\n    organizationId: recipientOrgId,\r\n    title: 'Nueva foto disponible',\r\n    message: `${senderOrgName} ha subido una nueva foto: \"${photoTitle}\"`,\r\n    data: { senderOrgName, photoTitle }\r\n  });\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de conexi√≥n establecida\r\n */\r\nexport async function sendConnectionEstablishedNotification(\r\n  userId: string,\r\n  orgId: string,\r\n  connectedOrgName: string\r\n) {\r\n  await sendNotification({\r\n    type: 'connection_established',\r\n    userId: userId,\r\n    organizationId: orgId,\r\n    title: 'Nueva conexi√≥n',\r\n    message: `Ahora est√°s conectado con ${connectedOrgName}.`,\r\n    data: { connectedOrgName }\r\n  });\r\n}\r\n\r\n/**\r\n * Enviar notificaci√≥n de perfil actualizado\r\n */\r\nexport async function sendProfileUpdatedNotification(\r\n  userId: string,\r\n  orgId: string,\r\n  fieldName: string\r\n) {\r\n  await sendNotification({\r\n    type: 'profile_updated',\r\n    userId: userId,\r\n    organizationId: orgId,\r\n    title: 'Perfil actualizado',\r\n    message: `Tu ${fieldName} ha sido actualizado correctamente.`,\r\n    data: { fieldName }\r\n  });\r\n}\r\n\r\n/**\r\n * Eliminar notificaci√≥n por ID\r\n */\r\nexport async function deleteNotification(notificationId: string) {\r\n  try {\r\n    const { error } = await supabase\r\n      .from('notifications')\r\n      .delete()\r\n      .eq('id', notificationId);\r\n\r\n    if (error) throw error;\r\n    console.log('Notification deleted successfully');\r\n    \r\n    return { success: true, error: null };  // ‚Üê DEVOLVER resultado\r\n  } catch (error) {\r\n    console.error('Failed to delete notification:', error);\r\n    return { success: false, error: (error as Error).message };  // ‚Üê DEVOLVER resultado\r\n  }\r\n}\r\n\r\n/**\r\n * Marcar notificaci√≥n como le√≠da\r\n */\r\nexport async function markNotificationAsRead(notificationId: string) {\r\n  try {\r\n    const { error } = await supabase\r\n      .from('notifications')\r\n      .update({ is_read: true })\r\n      .eq('id', notificationId);\r\n\r\n    if (error) throw error;\r\n    console.log('Notification marked as read');\r\n  } catch (error) {\r\n    console.error('Failed to mark notification as read:', error);\r\n    throw error;\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/hooks/useNotifications.ts"],"sourcesContent":["// src/hooks/useNotifications.ts\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '../lib/supabaseClient';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  user_id: string;\r\n  organization_id: string;\r\n  type: string;\r\n  title: string;\r\n  message: string;\r\n  data: any;\r\n  is_read: boolean;\r\n  created_at: string;\r\n  date: string; // ‚úÖ A√ëADIDO: Propiedad requerida por NotificationsDropdown\r\n}\r\n\r\nexport function useNotifications(userId: string | null) {\r\n  const [notifications, setNotifications] = useState<Notification[]>([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const loadNotifications = useCallback(async () => {\r\n    if (!userId) {\r\n      setNotifications([]);\r\n      setUnreadCount(0);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('notifications')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .order('created_at', { ascending: false })\r\n        .limit(20);\r\n\r\n      if (error) throw error;\r\n\r\n      // ‚úÖ Mapear para a√±adir la propiedad `date` basada en `created_at`\r\n      const notificationsWithDate = (data || []).map((n: any) => ({\r\n        ...n,\r\n        date: n.created_at // Convertir created_at ‚Üí date\r\n      }));\r\n\r\n      setNotifications(notificationsWithDate);\r\n      setUnreadCount(notificationsWithDate.filter((n: Notification) => !n.is_read).length);\r\n    } catch (error) {\r\n      console.error('Error loading notifications:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [userId]);\r\n\r\n  const markAsRead = useCallback(async (notificationId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('notifications')\r\n        .update({ is_read: true })\r\n        .eq('id', notificationId);\r\n\r\n      if (error) throw error;\r\n\r\n      setNotifications(prev =>\r\n        prev.map(n => (n.id === notificationId ? { ...n, is_read: true } : n))\r\n      );\r\n      setUnreadCount(prev => Math.max(0, prev - 1));\r\n    } catch (error) {\r\n      console.error('Error marking notification as read:', error);\r\n    }\r\n  }, []);\r\n\r\n  const markAllAsRead = useCallback(async () => {\r\n    if (!userId) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('notifications')\r\n        .update({ is_read: true })\r\n        .eq('user_id', userId)\r\n        .eq('is_read', false);\r\n\r\n      if (error) throw error;\r\n\r\n      setNotifications(prev => prev.map(n => ({ ...n, is_read: true })));\r\n      setUnreadCount(0);\r\n    } catch (error) {\r\n      console.error('Error marking all notifications as read:', error);\r\n    }\r\n  }, [userId]);\r\n\r\n  const deleteNotification = useCallback(async (notificationId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('notifications')\r\n        .delete()\r\n        .eq('id', notificationId);\r\n\r\n      if (error) throw error;\r\n\r\n      setNotifications(prev => prev.filter(n => n.id !== notificationId));\r\n      // Actualizar contador si la notificaci√≥n eliminada estaba sin leer\r\n      setUnreadCount(prev => Math.max(0, prev - 1));\r\n    } catch (error) {\r\n      console.error('Error deleting notification:', error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadNotifications();\r\n\r\n    if (!userId) return;\r\n\r\n    const channel = supabase\r\n      .channel(`notifications:${userId}`)\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'notifications',\r\n          filter: `user_id=eq.${userId}`\r\n        },\r\n        (payload) => {\r\n          console.log('Realtime event:', payload.eventType, payload);\r\n\r\n          if (payload.eventType === 'INSERT') {\r\n            // Nueva notificaci√≥n\r\n            const newNotification = {\r\n              ...(payload.new as any),\r\n              date: (payload.new as any).created_at // ‚úÖ A√±adir date\r\n            };\r\n            setNotifications(prev => [newNotification as Notification, ...prev]);\r\n            if (!(payload.new as any).is_read) {\r\n              setUnreadCount(prev => prev + 1);\r\n            }\r\n          } else if (payload.eventType === 'UPDATE') {\r\n            // Notificaci√≥n actualizada (marcada como le√≠da/no le√≠da)\r\n            const oldNotification = notifications.find(n => n.id === payload.old.id);\r\n            const newNotification = {\r\n              ...(payload.new as any),\r\n              date: (payload.new as any).created_at // ‚úÖ A√±adir date\r\n            } as Notification;\r\n\r\n            setNotifications(prev =>\r\n              prev.map(n => (n.id === newNotification.id ? { ...n, ...newNotification } : n))\r\n            );\r\n\r\n            // Actualizar contador si cambi√≥ el estado de lectura\r\n            if (oldNotification && oldNotification.is_read !== newNotification.is_read) {\r\n              if (newNotification.is_read) {\r\n                setUnreadCount(prev => Math.max(0, prev - 1));\r\n              } else {\r\n                setUnreadCount(prev => prev + 1);\r\n              }\r\n            }\r\n          } else if (payload.eventType === 'DELETE') {\r\n            // Notificaci√≥n eliminada\r\n            const deletedNotification = payload.old as Notification;\r\n            setNotifications(prev => prev.filter(n => n.id !== deletedNotification.id));\r\n            \r\n            // Actualizar contador si la notificaci√≥n eliminada estaba sin leer\r\n            if (!deletedNotification.is_read) {\r\n              setUnreadCount(prev => Math.max(0, prev - 1));\r\n            }\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [userId, loadNotifications, notifications]);\r\n\r\n  return {\r\n    notifications,\r\n    unreadCount,\r\n    loading: loading,\r\n    markAsRead,\r\n    markAllAsRead,\r\n    deleteNotification,\r\n    reload: loadNotifications\r\n  };\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 399, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/app/hotel-requests/page.tsx"],"sourcesContent":["// src/app/hotel-requests/page.tsx\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { supabase } from \"../../lib/supabaseClient\";\r\nimport { \r\n  sendInvitationReceivedNotification, \r\n  sendInvitationAcceptedNotification, \r\n  sendInvitationRejectedNotification,\r\n  deleteNotification \r\n} from '../../lib/notifications';\r\nimport { useNotifications } from '../../hooks/useNotifications';\r\n\r\ninterface AccessRequest {\r\n  id: string;\r\n  agency_name: string;\r\n  status: string;\r\n}\r\n\r\ninterface Agency {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\n// Componente NotificationsDropdown - VERSI√ìN COMPLETA SIN CHECK\r\ninterface Notification {\r\n  id: string;\r\n  title: string;\r\n  message: string;\r\n  date: string;\r\n  read?: boolean;\r\n}\r\n\r\ninterface NotificationsDropdownProps {\r\n  notifications: Notification[];\r\n  unreadCount: number;\r\n  loading: boolean;\r\n  markAsRead: (id: string) => void;\r\n  markAllAsRead: () => void;\r\n  deleteNotification: (id: string) => void;\r\n}\r\n\r\nconst NotificationsDropdown = ({ \r\n  notifications, \r\n  unreadCount, \r\n  loading, \r\n  markAsRead, \r\n  markAllAsRead, \r\n  deleteNotification \r\n}: NotificationsDropdownProps) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as HTMLElement;\r\n      if (!target.closest('.notifications-dropdown')) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"notifications-dropdown relative\">\r\n      {/* Bot√≥n campana con efecto hover */}\r\n      <button\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className=\"relative p-2 text-gray-600 hover:text-blue-600 transition-all hover:-translate-y-0.5\"\r\n      >\r\n        {/* Bell Icon */}\r\n        <svg\r\n          className=\"w-6 h-6\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth=\"1.8\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            d=\"M14.857 17.657A2 2 0 0113 19H11a2 2 0 01-1.857-1.343M6 8a6 6 0 1112 0c0 3.5 1.5 5 2 5.5H4c.5-.5 2-2 2-5.5z\"\r\n          />\r\n        </svg>\r\n\r\n        {unreadCount > 0 && (\r\n          <span className=\"absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-semibold w-5 h-5 rounded-full flex items-center justify-center shadow\">\r\n            {unreadCount}\r\n          </span>\r\n        )}\r\n      </button>\r\n\r\n      {isOpen && (\r\n        <div className=\"absolute right-0 mt-3 w-96 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden z-50 animate-fade-in-down\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50\">\r\n            <h3 className=\"font-semibold text-gray-900\">Notificaciones</h3>\r\n\r\n            {unreadCount > 0 && (\r\n              <button\r\n                onClick={markAllAsRead}\r\n                className=\"text-xs font-medium text-blue-600 hover:text-blue-700 hover:underline\"\r\n              >\r\n                Marcar todo como le√≠do\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Loading */}\r\n          {loading && (\r\n            <div className=\"p-6 text-center text-gray-500 text-sm\">\r\n              <div className=\"w-6 h-6 mx-auto mb-2 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\r\n              Cargando notificaciones...\r\n            </div>\r\n          )}\r\n\r\n          {/* Empty */}\r\n          {!loading && notifications.length === 0 && (\r\n            <div className=\"p-6 text-center text-gray-500 text-sm\">\r\n              <div className=\"text-5xl mb-3 opacity-30\">üîî</div>\r\n              No hay notificaciones\r\n            </div>\r\n          )}\r\n\r\n          {/* List - SIN ICONO DE CHECK */}\r\n          {!loading && notifications.length > 0 && (\r\n            <div className=\"max-h-96 overflow-y-auto divide-y divide-gray-100\">\r\n              {notifications.map((n) => (\r\n                <div\r\n                  key={n.id}\r\n                  className={`flex items-start gap-3 px-4 py-4 transition-all cursor-pointer ${\r\n                    !n.read ? \"bg-blue-50\" : \"hover:bg-gray-50\"\r\n                  }`}\r\n                  onClick={() => !n.read && markAsRead(n.id)}\r\n                >\r\n                  {/* Indicador de no le√≠do */}\r\n                  <div className=\"pt-1\">\r\n                    {!n.read && (\r\n                      <span className=\"block w-2 h-2 bg-blue-600 rounded-full animate-pulse\"></span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Contenido */}\r\n                  <div className=\"flex-1\">\r\n                    <p className=\"text-sm font-semibold text-gray-900\">\r\n                      {n.title}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-600 mt-1\">{n.message}</p>\r\n                    <p className=\"text-[11px] text-gray-400 mt-1\">{n.date}</p>\r\n                  </div>\r\n\r\n                  {/* SOLO BOT√ìN DE ELIMINAR */}\r\n                  <div className=\"flex items-start\">\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        deleteNotification(n.id);\r\n                      }}\r\n                      className=\"text-gray-400 hover:text-red-600 hover:scale-110 transition-transform\"\r\n                      title=\"Eliminar\"\r\n                    >\r\n                      {/* X Icon */}\r\n                      <svg\r\n                        className=\"w-4 h-4\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth=\"2\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          d=\"M6 18L18 6M6 6l12 12\"\r\n                        />\r\n                      </svg>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function HotelRequests() {\r\n  // Estados existentes\r\n  const [pendingInvitations, setPendingInvitations] = useState<AccessRequest[]>([]);\r\n  const [associations, setAssociations] = useState<AccessRequest[]>([]);\r\n  const [allAgencies, setAllAgencies] = useState<Agency[]>([]);\r\n  const [filteredAgencies, setFilteredAgencies] = useState<Agency[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [selectedAgency, setSelectedAgency] = useState<Agency | null>(null);\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'invitations' | 'gallery'>('invitations');\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Hook de notificaciones\r\n  const {\r\n    notifications,\r\n    unreadCount,\r\n    loading: notificationsLoading,\r\n    markAsRead,\r\n    markAllAsRead,\r\n    deleteNotification: deleteNotificationFromHook\r\n  } = useNotifications(userId);\r\n\r\n  // Cerrar dropdown al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n        setShowDropdown(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        const sessionResponse = await supabase.auth.getSession();\r\n        if (!sessionResponse.data.session) {\r\n          window.location.href = \"/login\";\r\n          return;\r\n        }\r\n\r\n        const userId = sessionResponse.data.session.user.id;\r\n        setUserId(userId);\r\n        \r\n        const orgResponse = await supabase\r\n          .from(\"organizations\")\r\n          .select(\"id, role, name\")\r\n          .eq(\"created_by\", userId)\r\n          .maybeSingle();\r\n\r\n        if (!orgResponse.data || orgResponse.data.role !== \"hotel\") {\r\n          alert(\"Solo los hoteles pueden acceder a esta p√°gina\");\r\n          window.location.href = \"/dashboard\";\r\n          return;\r\n        }\r\n\r\n        const hotelId = orgResponse.data.id;\r\n\r\n        // Cargar SOLO invitaciones recibidas (de agencias hacia el hotel)\r\n        const pendingResponse = await supabase\r\n          .from(\"agency_hotel_access\")\r\n          .select(\"id, status, agency_id\")\r\n          .eq(\"hotel_id\", hotelId)\r\n          .eq(\"status\", \"pending\")\r\n          .eq(\"created_by_role\", \"agency\"); // ‚Üê SOLO las que env√≠an las agencias\r\n\r\n        const pendingAgencyIds = pendingResponse.data?.map(inv => inv.agency_id) || [];\r\n        const pendingAgenciesResponse = await supabase\r\n          .from(\"organizations\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", pendingAgencyIds);\r\n\r\n        const pendingAgencyNameMap: Record<string, string> = {};\r\n        (pendingAgenciesResponse.data || []).forEach(agency => {\r\n          pendingAgencyNameMap[agency.id] = agency.name;\r\n        });\r\n\r\n        const formattedPending = (pendingResponse.data || []).map(inv => ({\r\n          id: inv.id,\r\n          agency_name: pendingAgencyNameMap[inv.agency_id] || \"Agencia desconocida\",\r\n          status: inv.status\r\n        }));\r\n\r\n        setPendingInvitations(formattedPending);\r\n\r\n        // Cargar asociaciones (aceptadas)\r\n        const associationsResponse = await supabase\r\n          .from(\"agency_hotel_access\")\r\n          .select(\"id, status, agency_id\")\r\n          .eq(\"hotel_id\", hotelId)\r\n          .eq(\"status\", \"approved\");\r\n\r\n        const associationAgencyIds = associationsResponse.data?.map(inv => inv.agency_id) || [];\r\n        const associationAgenciesResponse = await supabase\r\n          .from(\"organizations\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", associationAgencyIds);\r\n\r\n        const associationAgencyNameMap: Record<string, string> = {};\r\n        (associationAgenciesResponse.data || []).forEach(agency => {\r\n          associationAgencyNameMap[agency.id] = agency.name;\r\n        });\r\n\r\n        const formattedAssociations: AccessRequest[] = (associationsResponse.data || []).map(inv => ({\r\n          id: inv.id,\r\n          agency_name: associationAgencyNameMap[inv.agency_id] || \"Agencia desconocida\",\r\n          status: inv.status\r\n        }));\r\n\r\n        setAssociations(formattedAssociations);\r\n\r\n        // Cargar todas las agencias\r\n        const allAgenciesResponse = await supabase\r\n          .from(\"organizations\")\r\n          .select(\"id, name\")\r\n          .eq(\"role\", \"agency\");\r\n\r\n        setAllAgencies(allAgenciesResponse.data || []);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error(\"Error loading \", err);\r\n        setError(\"Error al cargar los datos\");\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n\r\n  // Filtrar agencias mientras se escribe\r\n  useEffect(() => {\r\n    if (searchTerm.trim() === \"\") {\r\n      setFilteredAgencies([]);\r\n      return;\r\n    }\r\n\r\n    const filtered = allAgencies.filter(agency =>\r\n      agency.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n    setFilteredAgencies(filtered);\r\n  }, [searchTerm, allAgencies]);\r\n\r\n  const handleSendInvitation = async () => {\r\n    if (!selectedAgency) {\r\n      setError(\"Por favor, selecciona una agencia\");\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      const sessionResponse = await supabase.auth.getSession();\r\n      const userId = sessionResponse.data.session?.user.id;\r\n      const orgResponse = await supabase\r\n        .from(\"organizations\")\r\n        .select(\"id, name\")\r\n        .eq(\"created_by\", userId)\r\n        .maybeSingle();\r\n\r\n      if (!orgResponse.data) throw new Error(\"Hotel no encontrado\");\r\n\r\n      // ‚úÖ Correcci√≥n 1: Destructuraci√≥n correcta + usar .neq() en lugar de .not()\r\n      const { data: existing, error: existingError } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .select(\"id, status\")\r\n        .eq(\"hotel_id\", orgResponse.data.id)\r\n        .eq(\"agency_id\", selectedAgency.id)\r\n        .neq(\"status\", \"rejected\"); // ‚úÖ .neq() en lugar de .not()\r\n\r\n      if (existingError) throw existingError;\r\n\r\n      if (existing && existing.length > 0) {\r\n        setError(\"Ya has enviado una invitaci√≥n a esta agencia\");\r\n        setSubmitting(false);\r\n        return;\r\n      }\r\n\r\n      // Crear la invitaci√≥n\r\n      const { error: insertError } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .insert({\r\n          agency_id: selectedAgency.id,\r\n          hotel_id: orgResponse.data.id,\r\n          status: \"pending\",\r\n          created_by_role: \"hotel\" // ‚Üê Marcar como enviada por hotel\r\n        });\r\n\r\n      if (insertError) throw insertError;\r\n\r\n      // ‚úÖ ENVIAR NOTIFICACI√ìN A LA AGENCIA\r\n      // Obtener el user_id de la agencia\r\n      const { data: agencyData, error: agencyError } = await supabase // ‚úÖ Correcci√≥n 2: destructuraci√≥n correcta\r\n        .from(\"organizations\")\r\n        .select(\"created_by\")\r\n        .eq(\"id\", selectedAgency.id)\r\n        .single();\r\n\r\n      if (agencyError) throw agencyError;\r\n\r\n      if (agencyData) {\r\n        await sendInvitationReceivedNotification(\r\n          agencyData.created_by,    // user_id de la agencia\r\n          selectedAgency.id,        // organization_id de la agencia\r\n          orgResponse.data.name     // nombre del hotel\r\n        );\r\n      }\r\n\r\n      // Limpiar formulario\r\n      setSelectedAgency(null);\r\n      setSearchTerm(\"\");\r\n      setError(\"\");\r\n      \r\n      // ‚úÖ Mostrar mensaje de √©xito\r\n      alert(\"‚úÖ Invitaci√≥n enviada correctamente\");\r\n    } catch (err) {\r\n      setError(\"Error al enviar invitaci√≥n: \" + (err as Error).message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleRespond = async (invitationId: string, status: \"approved\" | \"rejected\") => {\r\n    try {\r\n      // ‚úÖ Obtener datos de la invitaci√≥n\r\n      const { data: invitationData, error: invitationError } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .select(\"agency_id, hotel_id\")\r\n        .eq(\"id\", invitationId)\r\n        .single();\r\n\r\n      if (invitationError || !invitationData) {\r\n        console.error(\"Error al obtener invitaci√≥n:\", invitationError);\r\n        throw new Error(\"No se pudo obtener la informaci√≥n de la invitaci√≥n\");\r\n      }\r\n\r\n      // ‚úÖ Obtener la notificaci√≥n relacionada ANTES de actualizar el estado\r\n      const sessionResponse = await supabase.auth.getSession();\r\n      const currentUserId = sessionResponse.data.session?.user.id;\r\n\r\n      // Buscar la notificaci√≥n de invitaci√≥n recibida para esta agencia\r\n      const { data: notificationData, error: notificationError } = await supabase\r\n        .from(\"notifications\")\r\n        .select(\"id\")\r\n        .eq(\"user_id\", currentUserId)\r\n        .eq(\"type\", \"invitation_received\")\r\n        .eq(\"organization_id\", invitationData.agency_id)\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(1);\r\n\r\n      if (notificationError) throw notificationError;\r\n\r\n      // Actualizar el estado de la invitaci√≥n\r\n      const { error: updateError } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .update({ status })\r\n        .eq(\"id\", invitationId);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      // ‚úÖ ENVIAR NOTIFICACI√ìN A LA AGENCIA\r\n      // Obtener informaci√≥n de la agencia\r\n      const { data: agencyData, error: agencyError } = await supabase // ‚úÖ Correcci√≥n 3: destructuraci√≥n correcta\r\n        .from(\"organizations\")\r\n        .select(\"created_by, name\")\r\n        .eq(\"id\", invitationData.agency_id)\r\n        .single();\r\n\r\n      // Obtener nombre del hotel\r\n      const { data: hotelData, error: hotelError } = await supabase // ‚úÖ Correcci√≥n 4: destructuraci√≥n correcta\r\n        .from(\"organizations\")\r\n        .select(\"name\")\r\n        .eq(\"id\", invitationData.hotel_id)\r\n        .single();\r\n\r\n      if (agencyError || hotelError) throw new Error(\"Error al obtener datos de organizaci√≥n\");\r\n\r\n      if (agencyData && hotelData) {\r\n        if (status === \"approved\") {\r\n          await sendInvitationAcceptedNotification(\r\n            agencyData.created_by,      // user_id de la agencia\r\n            invitationData.agency_id,   // organization_id de la agencia\r\n            hotelData.name              // nombre del hotel\r\n          );\r\n        } else if (status === \"rejected\") {\r\n          await sendInvitationRejectedNotification(\r\n            agencyData.created_by,      // user_id de la agencia\r\n            invitationData.agency_id,   // organization_id de la agencia\r\n            hotelData.name              // nombre del hotel\r\n          );\r\n        }\r\n      }\r\n\r\n      // ‚úÖ ELIMINAR LA NOTIFICACI√ìN despu√©s de aceptar/rechazar\r\n      if (notificationData && notificationData.length > 0) {\r\n        await deleteNotification(notificationData[0].id);\r\n        \r\n        // ‚úÖ FORZAR RECARGA DE NOTIFICACIONES\r\n        const { data: sessionData } = await supabase.auth.getSession();\r\n        const userId = sessionData.session?.user.id;\r\n        if (userId) {\r\n          // Recargar notificaciones\r\n          const { data: notificationsData } = await supabase\r\n            .from(\"notifications\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", userId)\r\n            .order(\"created_at\", { ascending: false });\r\n        }\r\n      }\r\n\r\n      // Recargar datos...\r\n      const { data: sessionData } = await supabase.auth.getSession();\r\n      const userId = sessionData.session?.user.id;\r\n\r\n      const orgResponse = await supabase\r\n        .from(\"organizations\")\r\n        .select(\"id\")\r\n        .eq(\"created_by\", userId)\r\n        .maybeSingle();\r\n\r\n      if (!orgResponse.data) return;\r\n\r\n      const { data: pending } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .select(\"id, status, agency_id\")\r\n        .eq(\"hotel_id\", orgResponse.data.id)\r\n        .eq(\"status\", \"pending\")\r\n        .eq(\"created_by_role\", \"agency\"); // ‚Üê SOLO las que env√≠an las agencias\r\n\r\n      const agencyIds = pending?.map(p => p.agency_id) || [];\r\n      const { data: agencies } = await supabase\r\n        .from(\"organizations\")\r\n        .select(\"id, name\")\r\n        .in(\"id\", agencyIds);\r\n\r\n      const nameMap: Record<string, string> = {};\r\n      agencies?.forEach(a => nameMap[a.id] = a.name);\r\n\r\n      const formatted = pending?.map(p => ({\r\n        id: p.id,\r\n        agency_name: nameMap[p.agency_id] || \"Agencia desconocida\",\r\n        status: p.status\r\n      })) || [];\r\n\r\n      setPendingInvitations(formatted);\r\n      \r\n      // Si se aprueba, actualizar asociaciones\r\n      if (status === \"approved\") {\r\n        const { data: associations } = await supabase\r\n          .from(\"agency_hotel_access\")\r\n          .select(\"id, status, agency_id\")\r\n          .eq(\"hotel_id\", orgResponse.data.id)\r\n          .eq(\"status\", \"approved\");\r\n\r\n        const assocAgencyIds = associations?.map(a => a.agency_id) || [];\r\n        const { data: assocAgencies } = await supabase\r\n          .from(\"organizations\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", assocAgencyIds);\r\n\r\n        const assocNameMap: Record<string, string> = {};\r\n        assocAgencies?.forEach(a => assocNameMap[a.id] = a.name);\r\n\r\n        const formattedAssoc = associations?.map(a => ({\r\n          id: a.id,\r\n          agency_name: assocNameMap[a.agency_id] || \"Agencia desconocida\",\r\n          status: a.status\r\n        })) || [];\r\n\r\n        setAssociations(formattedAssoc);\r\n      }\r\n\r\n      // ‚úÖ Mostrar mensaje seg√∫n la acci√≥n\r\n      alert(status === \"approved\" \r\n        ? \"‚úÖ Invitaci√≥n aceptada. La agencia ha sido notificada.\"\r\n        : \"‚ùå Invitaci√≥n rechazada. La agencia ha sido notificada.\");\r\n    } catch (err) {\r\n      alert(\"Error al responder: \" + (err as Error).message);\r\n    }\r\n  };\r\n\r\n  const handleRemoveAssociation = async (associationId: string) => {\r\n    if (!confirm(\"¬øEst√°s seguro de eliminar esta asociaci√≥n?\")) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"agency_hotel_access\")\r\n        .delete()\r\n        .eq(\"id\", associationId);\r\n\r\n      if (error) throw error;\r\n\r\n      setAssociations(prev => prev.filter(assoc => assoc.id !== associationId));\r\n    } catch (err) {\r\n      alert(\"Error al eliminar asociaci√≥n: \" + (err as Error).message);\r\n    }\r\n  };\r\n\r\n  const handleSelectAgency = (agency: Agency) => {\r\n    setSelectedAgency(agency);\r\n    setSearchTerm(agency.name);\r\n    setShowDropdown(false);\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'approved': return '‚úÖ Aceptada';\r\n      case 'rejected': return '‚ùå Rechazada';\r\n      case 'pending': return '‚è≥ Pendiente';\r\n      default: return status;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex justify-center items-center bg-gray-50\">\r\n        <div className=\"p-8 bg-white rounded-xl shadow-sm text-center\">\r\n          <div className=\"w-8 h-8 mx-auto mb-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\r\n          <p className=\"text-gray-600 text-base\">Cargando...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 font-sans\">\r\n      {/* SIDEBAR */}\r\n      <aside className=\"w-72 bg-gradient-to-b from-blue-800 to-blue-900 text-white p-6 fixed left-0 top-0 h-screen flex flex-col\">\r\n        {/* Header con logo */}\r\n        <div className=\"flex items-center mb-8 pb-3 border-b border-white/10\">\r\n          <h1 className=\"text-xl font-bold tracking-tight\">Hotel Media Bank</h1>\r\n        </div>\r\n\r\n        {/* Navigation menu */}\r\n        <nav className=\"flex-1 flex flex-col gap-2 mb-8\">\r\n          <div \r\n            onClick={() => window.location.href = \"/dashboard\"}\r\n            className=\"px-4 py-3.5 rounded-lg cursor-pointer font-medium text-sm transition-all text-white/80 hover:bg-white/10\"\r\n          >\r\n            ‚Üê Volver al Dashboard\r\n          </div>\r\n        </nav>\r\n      </aside>\r\n\r\n      {/* MAIN CONTENT */}\r\n      <main className=\"ml-72 p-6\">\r\n        {/* TOP BAR */}\r\n        <div className=\"fixed top-0 left-72 right-0 h-16 bg-white shadow-sm flex items-center justify-between px-6 z-40\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <span className=\"text-sm text-gray-500 uppercase font-semibold\">\r\n              {activeTab === 'invitations' ? 'Solicitudes' : 'Galer√≠a de Im√°genes'}\r\n            </span>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-4\">\r\n            {/* Notifications Dropdown */}\r\n            <NotificationsDropdown\r\n              notifications={notifications}\r\n              unreadCount={unreadCount}\r\n              loading={notificationsLoading}\r\n              markAsRead={markAsRead}\r\n              markAllAsRead={markAllAsRead}\r\n              deleteNotification={deleteNotificationFromHook}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content with top padding */}\r\n        <div className=\"pt-24\">\r\n\r\n          {/* CONTENIDO SEG√öN PESTA√ëA */}\r\n          {activeTab === 'invitations' ? (\r\n            // === CONTENIDO ORIGINAL DE SOLICITUDES ===\r\n            <div className=\"max-w-3xl mx-auto\">\r\n              {/* Header */}\r\n              <div className=\"mb-6\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-1\">\r\n                  Gesti√≥n de Solicitudes\r\n                </h2>\r\n                <p className=\"text-gray-600 text-sm\">\r\n                  Administra tus invitaciones y asociaciones con agencias de viajes\r\n                </p>\r\n              </div>\r\n\r\n              {/* Error message */}\r\n              {error && (\r\n                <div className=\"mb-6 bg-red-50 border-l-4 border-red-500 p-3 rounded-r-lg\">\r\n                  <p className=\"text-red-700 text-sm\">{error}</p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Enviar invitaci√≥n */}\r\n              <div className=\"bg-white rounded-xl shadow-sm overflow-hidden mb-6\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <h3 className=\"text-lg font-bold text-gray-900 mb-2\">\r\n                    Enviar Invitaci√≥n\r\n                  </h3>\r\n                  \r\n\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type=\"text\"\r\n                      value={searchTerm}\r\n                      onChange={(e) => {\r\n                        setSearchTerm(e.target.value);\r\n                        setSelectedAgency(null);\r\n                        setShowDropdown(true);\r\n                      }}\r\n                      onFocus={() => {\r\n                        if (searchTerm.trim() !== \"\") {\r\n                          setShowDropdown(true);\r\n                        }\r\n                      }}\r\n                      onBlur={(e) => {\r\n                        setTimeout(() => {\r\n                          setShowDropdown(false);\r\n                        }, 200);\r\n                      }}\r\n                      placeholder=\"Busca una agencia de viajes...\"\r\n                      className=\"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm text-gray-900\"\r\n                      disabled={submitting}\r\n                    />\r\n\r\n                    {showDropdown && filteredAgencies.length > 0 && (\r\n                      <div \r\n                        ref={dropdownRef}\r\n                        className=\"absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg mt-2 max-h-60 overflow-y-auto shadow-lg z-50\"\r\n                      >\r\n                        {filteredAgencies.map(agency => (\r\n                          <div\r\n                            key={agency.id}\r\n                            onClick={() => handleSelectAgency(agency)}\r\n                            className=\"px-4 py-2.5 cursor-pointer hover:bg-blue-50 text-gray-800 text-sm transition-colors\"\r\n                          >\r\n                            {agency.name}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n\r\n                    {showDropdown && filteredAgencies.length === 0 && searchTerm.trim() !== \"\" && (\r\n                      <div \r\n                        ref={dropdownRef}\r\n                        className=\"absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg mt-2 max-h-60 overflow-y-auto shadow-lg z-50\"\r\n                      >\r\n                        <div className=\"px-4 py-2.5 text-gray-500 text-sm\">\r\n                          No se encontraron agencias\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {selectedAgency && (\r\n                    <div className=\"mt-3 p-3 bg-blue-50 rounded-lg\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                          <p className=\"text-xs font-semibold text-gray-700 mb-1\">\r\n                            Agencia seleccionada:\r\n                          </p>\r\n                          <p className=\"text-sm font-bold text-blue-600\">\r\n                            {selectedAgency.name}\r\n                          </p>\r\n                        </div>\r\n                        <button\r\n                          onClick={() => {\r\n                            setSelectedAgency(null);\r\n                            setSearchTerm(\"\");\r\n                          }}\r\n                          className=\"text-red-500 hover:text-red-600 text-xs font-medium\"\r\n                        >\r\n                          ‚úï Eliminar\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <button\r\n                    onClick={handleSendInvitation}\r\n                    disabled={!selectedAgency || submitting}\r\n                    className={`mt-4 w-full px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${\r\n                      selectedAgency && !submitting\r\n                        ? \"bg-blue-500 text-white hover:bg-blue-600 hover:shadow-sm\"\r\n                        : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\r\n                    }`}\r\n                  >\r\n                    {submitting ? \"Enviando...\" : \"üì§ Enviar Invitaci√≥n\"}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Invitaciones pendientes (SOLO las que me env√≠an las agencias) */}\r\n              <div className=\"bg-white rounded-xl shadow-sm overflow-hidden mb-6\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <h3 className=\"text-lg font-bold text-gray-900 mb-2\">\r\n                    üì® Solicitudes Recibidas\r\n                  </h3>\r\n                  \r\n\r\n                  {pendingInvitations.length === 0 ? (\r\n                    <div className=\"text-center py-8\">\r\n                      <div className=\"text-4xl mb-3 opacity-30\">üì≠</div>\r\n                      <p className=\"text-gray-500 text-sm\">\r\n                        No tienes solicitudes pendientes\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-3\">\r\n                      {pendingInvitations.map(inv => (\r\n                        <div\r\n                          key={inv.id}\r\n                          className=\"border border-gray-200 rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition-all\"\r\n                        >\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <h4 className=\"font-bold text-gray-900 text-sm mb-1\">\r\n                                {inv.agency_name}\r\n                              </h4>\r\n                              <p className=\"text-xs text-gray-600\">\r\n                                {getStatusText(inv.status)}\r\n                              </p>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                              <button\r\n                                onClick={() => handleRespond(inv.id, \"approved\")}\r\n                                className=\"px-3 py-1.5 bg-green-500 text-white rounded-lg font-semibold text-xs hover:bg-green-600 transition-colors\"\r\n                              >\r\n                                ‚úÖ Aceptar\r\n                              </button>\r\n                              <button\r\n                                onClick={() => handleRespond(inv.id, \"rejected\")}\r\n                                className=\"px-3 py-1.5 bg-red-500 text-white rounded-lg font-semibold text-xs hover:bg-red-600 transition-colors\"\r\n                              >\r\n                                ‚ùå Rechazar\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Asociaciones activas */}\r\n              <div className=\"bg-white rounded-xl shadow-sm overflow-hidden\">\r\n                <div className=\"p-6\">\r\n                  <h3 className=\"text-lg font-bold text-gray-900 mb-2\">\r\n                    Asociaciones Activas\r\n                  </h3>\r\n                  \r\n\r\n                  {associations.length === 0 ? (\r\n                    <div className=\"text-center py-8\">\r\n                      <div className=\"text-4xl mb-3 opacity-30\">üîó</div>\r\n                      <p className=\"text-gray-500 text-sm\">\r\n                        No tienes asociaciones activas\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-3\">\r\n                      {associations.map(assoc => (\r\n                        <div\r\n                          key={assoc.id}\r\n                          className=\"border border-gray-200 rounded-lg p-4 bg-gray-50\"\r\n                        >\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <h4 className=\"font-bold text-gray-900 text-sm mb-1\">\r\n                                {assoc.agency_name}\r\n                              </h4>\r\n                              <p className=\"text-xs text-gray-600\">\r\n                                {getStatusText(assoc.status)}\r\n                              </p>\r\n                            </div>\r\n                            <button\r\n                              onClick={() => handleRemoveAssociation(assoc.id)}\r\n                              className=\"px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-xs hover:bg-gray-300 transition-colors\"\r\n                            >\r\n                              Eliminar\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            // === GALER√çA DE IM√ÅGENES ===\r\n            <div>\r\n              \r\n            </div>\r\n          )}\r\n        </div>\r\n      </main>\r\n\r\n      {/* Estilos globales para animaciones */}\r\n      <style jsx global>{`\r\n        @keyframes fade-in-down {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateY(-10px);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateY(0);\r\n          }\r\n        }\r\n        .animate-fade-in-down {\r\n          animation: fade-in-down 0.2s ease-out;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}