{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/ai.ts"],"sourcesContent":["// src/lib/ai.ts\r\n\r\n/**\r\n * Llama al backend CLIP para analizar una imagen y devolver tags limpios.\r\n * Esta funci√≥n NO normaliza: solo limpia y prepara los tags.\r\n * La normalizaci√≥n completa la hace normalizeTags() despu√©s.\r\n */\r\n\r\nexport async function analyzeImage(url: string, threshold: number = 0.20) {\r\n  try {\r\n    if (!url || typeof url !== \"string\") {\r\n      console.error(\"‚ùå URL inv√°lida en analyzeImage:\", url);\r\n      return { tags: [], confidence: null };\r\n    }\r\n\r\n    const response = await fetch(\"http://localhost:8000/analyze\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ url, threshold }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.error(\"‚ùå Error en backend /analyze:\", response.status);\r\n      return { tags: [], confidence: null };\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    if (!data || !Array.isArray(data.tags)) {\r\n      console.warn(\"‚ö†Ô∏è Backend devolvi√≥ formato inesperado:\", data);\r\n      return { tags: [], confidence: null };\r\n    }\r\n\r\n    // ------------------------------------------------------------\r\n    // ‚≠ê Limpieza segura de tags (NO normalizaci√≥n completa)\r\n    // ------------------------------------------------------------\r\n    const tags = data.tags\r\n      .map((t: any) => {\r\n        if (typeof t === \"object\" && t.label) return String(t.label).trim();\r\n        if (typeof t === \"string\") return t.trim();\r\n        return null;\r\n      })\r\n      .filter(Boolean);\r\n\r\n    return {\r\n      tags,\r\n      confidence: data.confidence ?? null,\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error al analizar imagen:\", error);\r\n    return { tags: [], confidence: null };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;AAEhB;;;;CAIC;;;;AAEM,eAAe,aAAa,GAAW,EAAE,YAAoB,IAAI;IACtE,IAAI;QACF,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;YACnC,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO;gBAAE,MAAM,EAAE;gBAAE,YAAY;YAAK;QACtC;QAEA,MAAM,WAAW,MAAM,MAAM,iCAAiC;YAC5D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAK;YAAU;QACxC;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,gCAAgC,SAAS,MAAM;YAC7D,OAAO;gBAAE,MAAM,EAAE;gBAAE,YAAY;YAAK;QACtC;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,QAAQ,CAAC,MAAM,OAAO,CAAC,KAAK,IAAI,GAAG;YACtC,QAAQ,IAAI,CAAC,2CAA2C;YACxD,OAAO;gBAAE,MAAM,EAAE;gBAAE,YAAY;YAAK;QACtC;QAEA,+DAA+D;QAC/D,wDAAwD;QACxD,+DAA+D;QAC/D,MAAM,OAAO,KAAK,IAAI,CACnB,GAAG,CAAC,CAAC;YACJ,IAAI,OAAO,MAAM,YAAY,EAAE,KAAK,EAAE,OAAO,OAAO,EAAE,KAAK,EAAE,IAAI;YACjE,IAAI,OAAO,MAAM,UAAU,OAAO,EAAE,IAAI;YACxC,OAAO;QACT,GACC,MAAM,CAAC;QAEV,OAAO;YACL;YACA,YAAY,KAAK,UAAU,IAAI;QACjC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;YAAE,MAAM,EAAE;YAAE,YAAY;QAAK;IACtC;AACF"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/normalizeTags.ts"],"sourcesContent":["// src/lib/normalizeTags.ts\r\n\r\n/**\r\n * Normaliza y limpia tags provenientes del backend (CLIP).\r\n * - Convierte objetos {label, score} ‚Üí string\r\n * - Lowercase\r\n * - Trim\r\n * - Elimina duplicados\r\n * - Unifica sin√≥nimos\r\n * - Corrige tags ambiguos\r\n * - Evita que \"view\" bloquee habitaciones\r\n * - Evita que \"outdoor\" bloquee piscina\r\n */\r\n\r\nexport function normalizeTags(rawTags: any[]) {\r\n  console.log(\"üî• normalizeTags() recibi√≥:\", rawTags);\r\n\r\n  if (!Array.isArray(rawTags)) {\r\n    console.log(\"üî• normalizeTags() devolvi√≥: [] (rawTags no es array)\");\r\n    return [];\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 1. Convertir objetos {label, score} ‚Üí strings\r\n  // ------------------------------------------------------------\r\n  let cleaned = rawTags\r\n    .map(t => (typeof t === \"object\" ? t.label : t))\r\n    .map(t => String(t || \"\").toLowerCase().trim())\r\n    .filter(Boolean);\r\n\r\n  console.log(\"üî• normalizeTags() cleaned:\", cleaned);\r\n\r\n  // ------------------------------------------------------------\r\n  // 2. Unificar sin√≥nimos y variaciones comunes\r\n  // ------------------------------------------------------------\r\n  const replacements: Record<string, string> = {\r\n    \"outdoor pool\": \"pool\",\r\n    \"infinity pool\": \"pool\",\r\n    \"hotel pool\": \"pool\",\r\n    \"pool area\": \"pool\",\r\n    \"poolside\": \"pool\",\r\n    \"tropical pool\": \"pool\",\r\n\r\n    \"massage room\": \"spa\",\r\n    \"wellness area\": \"spa\",\r\n    \"steam room\": \"spa\",\r\n    \"sauna room\": \"spa\",\r\n    \"hammam\": \"spa\",\r\n    \"treatment room\": \"spa\",\r\n\r\n    \"city view\": \"view\",\r\n    \"urban view\": \"view\",\r\n    \"skyline\": \"view\",\r\n    \"cityscape\": \"view\",\r\n    \"sea view\": \"view\",\r\n    \"ocean view\": \"view\",\r\n    \"panoramic view\": \"view\",\r\n\r\n    \"roof terrace\": \"terrace\",\r\n    \"sky bar\": \"terrace\",\r\n\r\n    \"hotel room\": \"room\",\r\n    \"double room\": \"room\",\r\n    \"single room\": \"room\",\r\n    \"bedroom\": \"room\",\r\n    \"room interior\": \"room\",\r\n    \"room view\": \"room\"\r\n  };\r\n\r\n  cleaned = cleaned.map(tag => replacements[tag] || tag);\r\n\r\n  // ------------------------------------------------------------\r\n  // 3. Detectar habitaci√≥n ANTES de limpiar exterior\r\n  // ------------------------------------------------------------\r\n  const hasRoom = cleaned.includes(\"room\");\r\n\r\n  // ------------------------------------------------------------\r\n  // 4. Detectar spa\r\n  // ------------------------------------------------------------\r\n  const hasSpa = cleaned.includes(\"spa\");\r\n\r\n  // ------------------------------------------------------------\r\n  // 5. Detectar piscina\r\n  // ------------------------------------------------------------\r\n  const hasPool = cleaned.includes(\"pool\");\r\n\r\n  // ------------------------------------------------------------\r\n  // 6. Detectar exterior\r\n  // ------------------------------------------------------------\r\n  const hasExterior = cleaned.some(t =>\r\n    [\"exterior\", \"facade\", \"building\", \"outdoor\", \"garden\"].includes(t)\r\n  );\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê REGLA 1: Si es habitaci√≥n ‚Üí NO limpiar nada\r\n  // ------------------------------------------------------------\r\n  if (hasRoom) {\r\n    const result = Array.from(new Set(cleaned));\r\n    console.log(\"üî• normalizeTags() devolvi√≥ (habitaci√≥n detectada):\", result);\r\n    return result;\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê REGLA 2: Si es spa ‚Üí NO limpiar nada\r\n  // ------------------------------------------------------------\r\n  if (hasSpa) {\r\n    const result = Array.from(new Set(cleaned));\r\n    console.log(\"üî• normalizeTags() devolvi√≥ (spa detectado):\", result);\r\n    return result;\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê REGLA 3: Si es piscina ‚Üí NO limpiar nada\r\n  // ------------------------------------------------------------\r\n  if (hasPool) {\r\n    const result = Array.from(new Set(cleaned));\r\n    console.log(\"üî• normalizeTags() devolvi√≥ (piscina detectada):\", result);\r\n    return result;\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê REGLA 4: Si es exterior ‚Üí eliminar interior\r\n  // ------------------------------------------------------------\r\n  if (hasExterior) {\r\n    const interior = [\r\n      \"room\",\r\n      \"dining room\",\r\n      \"meeting room\",\r\n      \"common area\",\r\n      \"coworking area\",\r\n      \"kids club\",\r\n      \"lobby\",\r\n      \"interior\"\r\n    ];\r\n\r\n    const result = Array.from(\r\n      new Set(cleaned.filter(t => !interior.includes(t)))\r\n    );\r\n\r\n    console.log(\"üî• normalizeTags() devolvi√≥ (exterior sin interior):\", result);\r\n    return result;\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê REGLA 5: Default ‚Üí devolver sin duplicados\r\n  // ------------------------------------------------------------\r\n  const result = Array.from(new Set(cleaned));\r\n  console.log(\"üî• normalizeTags() devolvi√≥ (default):\", result);\r\n  return result;\r\n}\r\n"],"names":[],"mappings":"AAAA,2BAA2B;AAE3B;;;;;;;;;;CAUC;;;;AAEM,SAAS,cAAc,OAAc;IAC1C,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU;QAC3B,QAAQ,GAAG,CAAC;QACZ,OAAO,EAAE;IACX;IAEA,+DAA+D;IAC/D,gDAAgD;IAChD,+DAA+D;IAC/D,IAAI,UAAU,QACX,GAAG,CAAC,CAAA,IAAM,OAAO,MAAM,WAAW,EAAE,KAAK,GAAG,GAC5C,GAAG,CAAC,CAAA,IAAK,OAAO,KAAK,IAAI,WAAW,GAAG,IAAI,IAC3C,MAAM,CAAC;IAEV,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,+DAA+D;IAC/D,8CAA8C;IAC9C,+DAA+D;IAC/D,MAAM,eAAuC;QAC3C,gBAAgB;QAChB,iBAAiB;QACjB,cAAc;QACd,aAAa;QACb,YAAY;QACZ,iBAAiB;QAEjB,gBAAgB;QAChB,iBAAiB;QACjB,cAAc;QACd,cAAc;QACd,UAAU;QACV,kBAAkB;QAElB,aAAa;QACb,cAAc;QACd,WAAW;QACX,aAAa;QACb,YAAY;QACZ,cAAc;QACd,kBAAkB;QAElB,gBAAgB;QAChB,WAAW;QAEX,cAAc;QACd,eAAe;QACf,eAAe;QACf,WAAW;QACX,iBAAiB;QACjB,aAAa;IACf;IAEA,UAAU,QAAQ,GAAG,CAAC,CAAA,MAAO,YAAY,CAAC,IAAI,IAAI;IAElD,+DAA+D;IAC/D,mDAAmD;IACnD,+DAA+D;IAC/D,MAAM,UAAU,QAAQ,QAAQ,CAAC;IAEjC,+DAA+D;IAC/D,kBAAkB;IAClB,+DAA+D;IAC/D,MAAM,SAAS,QAAQ,QAAQ,CAAC;IAEhC,+DAA+D;IAC/D,sBAAsB;IACtB,+DAA+D;IAC/D,MAAM,UAAU,QAAQ,QAAQ,CAAC;IAEjC,+DAA+D;IAC/D,uBAAuB;IACvB,+DAA+D;IAC/D,MAAM,cAAc,QAAQ,IAAI,CAAC,CAAA,IAC/B;YAAC;YAAY;YAAU;YAAY;YAAW;SAAS,CAAC,QAAQ,CAAC;IAGnE,+DAA+D;IAC/D,gDAAgD;IAChD,+DAA+D;IAC/D,IAAI,SAAS;QACX,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI;QAClC,QAAQ,GAAG,CAAC,uDAAuD;QACnE,OAAO;IACT;IAEA,+DAA+D;IAC/D,yCAAyC;IACzC,+DAA+D;IAC/D,IAAI,QAAQ;QACV,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI;QAClC,QAAQ,GAAG,CAAC,gDAAgD;QAC5D,OAAO;IACT;IAEA,+DAA+D;IAC/D,6CAA6C;IAC7C,+DAA+D;IAC/D,IAAI,SAAS;QACX,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI;QAClC,QAAQ,GAAG,CAAC,oDAAoD;QAChE,OAAO;IACT;IAEA,+DAA+D;IAC/D,gDAAgD;IAChD,+DAA+D;IAC/D,IAAI,aAAa;QACf,MAAM,WAAW;YACf;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,MAAM,SAAS,MAAM,IAAI,CACvB,IAAI,IAAI,QAAQ,MAAM,CAAC,CAAA,IAAK,CAAC,SAAS,QAAQ,CAAC;QAGjD,QAAQ,GAAG,CAAC,wDAAwD;QACpE,OAAO;IACT;IAEA,+DAA+D;IAC/D,+CAA+C;IAC/C,+DAA+D;IAC/D,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI;IAClC,QAAQ,GAAG,CAAC,0CAA0C;IACtD,OAAO;AACT"}},
    {"offset": {"line": 301, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/utils/categoryMap.ts"],"sourcesContent":["// utils/categoryMap.ts\r\n\r\nexport type RawTag = string | { label: string; score?: number };\r\n\r\n/**\r\n * Mapa de categor√≠as ampliado y optimizado para hoteles reales.\r\n * Incluye coincidencias parciales y variaciones reales de CLIP.\r\n */\r\nexport const CATEGORY_MAP: Record<string, string[]> = {\r\n  piscina: [\r\n    'pool',\r\n    'swimming pool',\r\n    'outdoor pool',\r\n    'infinity pool',\r\n    'hotel pool',\r\n    'pool area',\r\n    'poolside',\r\n    'tropical pool'\r\n  ],\r\n\r\n  habitaciones: [\r\n    'hotel room',\r\n    'suite',\r\n    'bedroom',\r\n    'double room',\r\n    'single room',\r\n    'king bed',\r\n    'queen bed',\r\n    'room interior',\r\n    'room view'\r\n  ],\r\n\r\n  vistas: [\r\n    'city view',\r\n    'skyline',\r\n    'urban view',\r\n    'cityscape',\r\n    'sea view',\r\n    'ocean view',\r\n    'mountain view',\r\n    'panoramic view'\r\n  ],\r\n\r\n  terraza: [\r\n    'terrace',\r\n    'balcony',\r\n    'rooftop',\r\n    'roof terrace',\r\n    'sky bar'\r\n  ],\r\n\r\n  fachada: [\r\n    'facade',\r\n    'building',\r\n    'entrance',\r\n    'hotel exterior',\r\n    'exterior view'\r\n  ],\r\n\r\n  restaurante: [\r\n    'restaurant',\r\n    'bar',\r\n    'buffet',\r\n    'breakfast area',\r\n    'dining area'\r\n  ],\r\n\r\n  spa: [\r\n    'spa',\r\n    'massage room',\r\n    'wellness',\r\n    'wellness area',\r\n    'sauna',\r\n    'steam room',\r\n    'hammam',\r\n    'gym',\r\n    'fitness',\r\n    'treatment'\r\n  ],\r\n\r\n  salas_comunes: [\r\n    'lobby',\r\n    'reception',\r\n    'common area',\r\n    'hall',\r\n    'lounge',\r\n    'waiting area'\r\n  ],\r\n\r\n  interior: [\r\n    'corridor',\r\n    'hallway',\r\n    'interior',\r\n    'bathroom',\r\n    'indoor'\r\n  ],\r\n\r\n  exterior: [\r\n    'exterior',\r\n    'garden',\r\n    'outdoor',\r\n    'parking',\r\n    'patio'\r\n  ]\r\n};\r\n\r\n/**\r\n * Normaliza tags a string[] en lowercase\r\n */\r\nfunction normalizeTags(tags: RawTag[]): string[] {\r\n  return tags\r\n    .flatMap(tag => {\r\n      if (typeof tag === 'string') {\r\n        const t = tag.trim();\r\n\r\n        if (t.startsWith('{') && t.endsWith('}')) {\r\n          try {\r\n            const parsed = JSON.parse(t);\r\n            if (parsed?.label) return parsed.label;\r\n          } catch {}\r\n        }\r\n\r\n        return t;\r\n      }\r\n\r\n      if (typeof tag === 'object' && typeof tag.label === 'string') {\r\n        return tag.label;\r\n      }\r\n\r\n      return [];\r\n    })\r\n    .filter(Boolean)\r\n    .map(t => t.toLowerCase());\r\n}\r\n\r\n/**\r\n * Detecta categor√≠a con prioridades reales de hotel\r\n * PRIORIDADES:\r\n * 1. piscina\r\n * 2. spa\r\n * 3. habitaciones\r\n * 4. restaurante\r\n * 5. salas comunes\r\n * 6. vistas\r\n * 7. terraza\r\n * 8. fachada\r\n * 9. interior\r\n * 10. exterior\r\n */\r\nexport function detectCategory(tags: RawTag[]): string {\r\n  const normalized = normalizeTags(tags);\r\n\r\n  if (!normalized.length) return 'otros';\r\n\r\n  const has = (keyword: string) =>\r\n    normalized.some(t => t.includes(keyword));\r\n\r\n  // ------------------------------------------------------------\r\n  // 1. Piscina\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('pool') ||\r\n    has('poolside') ||\r\n    has('infinity')\r\n  ) {\r\n    return 'piscina';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 2. Spa / Wellness\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('spa') ||\r\n    has('hammam') ||\r\n    has('sauna') ||\r\n    has('steam') ||\r\n    has('massage') ||\r\n    has('wellness') ||\r\n    has('treatment') ||\r\n    has('gym') ||\r\n    has('fitness')\r\n  ) {\r\n    return 'spa';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 3. Habitaciones (aunque tenga \"view\")\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('room') ||\r\n    has('suite') ||\r\n    has('bedroom') ||\r\n    has('double room') ||\r\n    has('single room') ||\r\n    has('king') ||\r\n    has('queen')\r\n  ) {\r\n    return 'habitaciones';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 4. Restaurante\r\n  // ------------------------------------------------------------\r\n  if (has('restaurant') || has('bar') || has('buffet') || has('dining')) {\r\n    return 'restaurante';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 5. Salas comunes\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('lobby') ||\r\n    has('reception') ||\r\n    has('common area') ||\r\n    has('hall') ||\r\n    has('lounge')\r\n  ) {\r\n    return 'salas_comunes';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 6. Vistas\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('city view') ||\r\n    has('skyline') ||\r\n    has('urban') ||\r\n    has('sea view') ||\r\n    has('ocean view') ||\r\n    has('panoramic')\r\n  ) {\r\n    return 'vistas';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 7. Terraza\r\n  // ------------------------------------------------------------\r\n  if (has('terrace') || has('balcony') || has('rooftop') || has('sky bar')) {\r\n    return 'terraza';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 8. Fachada\r\n  // ------------------------------------------------------------\r\n  if (has('facade') || has('building') || has('entrance')) {\r\n    return 'fachada';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 9. Interior\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('bathroom') ||\r\n    has('corridor') ||\r\n    has('interior') ||\r\n    has('hallway')\r\n  ) {\r\n    return 'interior';\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // 10. Exterior\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has('exterior') ||\r\n    has('garden') ||\r\n    has('outdoor') ||\r\n    has('parking') ||\r\n    has('patio')\r\n  ) {\r\n    return 'exterior';\r\n  }\r\n\r\n  return 'otros';\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 486, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/scenePriority.ts"],"sourcesContent":["// src/lib/scenePriority.ts\r\n\r\nimport { RawTag } from \"@/utils/categoryMap\";\r\n\r\nexport type SceneType =\r\n  | \"piscina\"\r\n  | \"spa\"\r\n  | \"restaurante\"\r\n  | \"bar\"\r\n  | \"habitaciones\"\r\n  | \"zonas_comunes\"\r\n  | \"vistas\"\r\n  | \"terraza\"\r\n  | \"fachada\"\r\n  | \"exterior\"\r\n  | \"otros\";\r\n\r\nexport function detectScenePriority(tags: RawTag[]): SceneType {\r\n  // Normalizaci√≥n b√°sica\r\n  const normalized = tags\r\n    .map((t: any) =>\r\n      typeof t === \"string\"\r\n        ? t.toLowerCase()\r\n        : typeof t.label === \"string\"\r\n        ? t.label.toLowerCase()\r\n        : \"\"\r\n    )\r\n    .filter(Boolean);\r\n\r\n  const has = (key: string) => normalized.includes(key);\r\n\r\n  // ------------------------------------------------------------\r\n  // üß† DETECCI√ìN DE EXTERIOR (menos agresiva)\r\n  // ------------------------------------------------------------\r\n  const isExterior =\r\n    has(\"exterior\") ||\r\n    has(\"facade\") ||\r\n    has(\"building\") ||\r\n    has(\"entrance\") ||\r\n    has(\"outdoor\") ||\r\n    has(\"garden\");\r\n\r\n  // ------------------------------------------------------------\r\n  // üèä Piscina (m√°xima prioridad)\r\n  // ------------------------------------------------------------\r\n  if (has(\"pool\")) {\r\n    return \"piscina\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üíÜ Spa / Wellness\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has(\"spa\") ||\r\n    has(\"hammam\") ||\r\n    has(\"sauna\") ||\r\n    has(\"steam\") ||\r\n    has(\"massage\") ||\r\n    has(\"wellness\") ||\r\n    has(\"treatment\")\r\n  ) {\r\n    return \"spa\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üçΩÔ∏è Restaurante\r\n  // ------------------------------------------------------------\r\n  if (has(\"restaurant\") || has(\"buffet\") || has(\"dining\")) {\r\n    return \"restaurante\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üç∏ Bar\r\n  // ------------------------------------------------------------\r\n  if (has(\"bar\") || has(\"rooftop\") || has(\"cocktail\")) {\r\n    return \"bar\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üõèÔ∏è Habitaciones (ya NO bloqueadas por \"view\")\r\n  // ------------------------------------------------------------\r\n  if (has(\"room\") || has(\"suite\")) {\r\n    return \"habitaciones\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üõãÔ∏è Zonas comunes\r\n  // ------------------------------------------------------------\r\n  if (\r\n    has(\"lobby\") ||\r\n    has(\"reception\") ||\r\n    has(\"common area\") ||\r\n    has(\"lounge\") ||\r\n    has(\"coworking\") ||\r\n    has(\"meeting\")\r\n  ) {\r\n    return \"zonas_comunes\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üåä Vistas\r\n  // ------------------------------------------------------------\r\n  if (has(\"view\")) {\r\n    return \"vistas\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üåÖ Terraza\r\n  // ------------------------------------------------------------\r\n  if (has(\"terrace\") || has(\"balcony\") || has(\"rooftop\")) {\r\n    return \"terraza\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üè¢ Fachada\r\n  // ------------------------------------------------------------\r\n  if (has(\"facade\") || has(\"building\") || has(\"entrance\")) {\r\n    return \"fachada\";\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üå¥ Exterior\r\n  // ------------------------------------------------------------\r\n  if (isExterior) {\r\n    return \"exterior\";\r\n  }\r\n\r\n  return \"otros\";\r\n}\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAiBpB,SAAS,oBAAoB,IAAc;IAChD,uBAAuB;IACvB,MAAM,aAAa,KAChB,GAAG,CAAC,CAAC,IACJ,OAAO,MAAM,WACT,EAAE,WAAW,KACb,OAAO,EAAE,KAAK,KAAK,WACnB,EAAE,KAAK,CAAC,WAAW,KACnB,IAEL,MAAM,CAAC;IAEV,MAAM,MAAM,CAAC,MAAgB,WAAW,QAAQ,CAAC;IAEjD,+DAA+D;IAC/D,4CAA4C;IAC5C,+DAA+D;IAC/D,MAAM,aACJ,IAAI,eACJ,IAAI,aACJ,IAAI,eACJ,IAAI,eACJ,IAAI,cACJ,IAAI;IAEN,+DAA+D;IAC/D,gCAAgC;IAChC,+DAA+D;IAC/D,IAAI,IAAI,SAAS;QACf,OAAO;IACT;IAEA,+DAA+D;IAC/D,oBAAoB;IACpB,+DAA+D;IAC/D,IACE,IAAI,UACJ,IAAI,aACJ,IAAI,YACJ,IAAI,YACJ,IAAI,cACJ,IAAI,eACJ,IAAI,cACJ;QACA,OAAO;IACT;IAEA,+DAA+D;IAC/D,kBAAkB;IAClB,+DAA+D;IAC/D,IAAI,IAAI,iBAAiB,IAAI,aAAa,IAAI,WAAW;QACvD,OAAO;IACT;IAEA,+DAA+D;IAC/D,SAAS;IACT,+DAA+D;IAC/D,IAAI,IAAI,UAAU,IAAI,cAAc,IAAI,aAAa;QACnD,OAAO;IACT;IAEA,+DAA+D;IAC/D,iDAAiD;IACjD,+DAA+D;IAC/D,IAAI,IAAI,WAAW,IAAI,UAAU;QAC/B,OAAO;IACT;IAEA,+DAA+D;IAC/D,oBAAoB;IACpB,+DAA+D;IAC/D,IACE,IAAI,YACJ,IAAI,gBACJ,IAAI,kBACJ,IAAI,aACJ,IAAI,gBACJ,IAAI,YACJ;QACA,OAAO;IACT;IAEA,+DAA+D;IAC/D,YAAY;IACZ,+DAA+D;IAC/D,IAAI,IAAI,SAAS;QACf,OAAO;IACT;IAEA,+DAA+D;IAC/D,aAAa;IACb,+DAA+D;IAC/D,IAAI,IAAI,cAAc,IAAI,cAAc,IAAI,YAAY;QACtD,OAAO;IACT;IAEA,+DAA+D;IAC/D,aAAa;IACb,+DAA+D;IAC/D,IAAI,IAAI,aAAa,IAAI,eAAe,IAAI,aAAa;QACvD,OAAO;IACT;IAEA,+DAA+D;IAC/D,cAAc;IACd,+DAA+D;IAC/D,IAAI,YAAY;QACd,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 565, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/sceneWeights.ts"],"sourcesContent":["// src/lib/sceneWeights.ts\r\n\r\nexport interface WeightedElement {\r\n  key: string;\r\n  weight: number;\r\n}\r\n\r\nexport interface SceneWeights {\r\n  scene: string;\r\n  elements: WeightedElement[];\r\n}\r\n\r\nexport function computeSceneWeights(tags: string[]): SceneWeights {\r\n  // Normalizamos tags\r\n  const normalized = tags.map(t => t.toLowerCase()).filter(Boolean);\r\n\r\n  const has = (key: string) => normalized.includes(key);\r\n\r\n  const weights: WeightedElement[] = [];\r\n\r\n  // ------------------------------------------------------------\r\n  // üß† DETECCI√ìN DE EXTERIOR (menos agresiva que antes)\r\n  // ------------------------------------------------------------\r\n  const isExterior =\r\n    has(\"exterior\") ||\r\n    has(\"facade\") ||\r\n    has(\"building\") ||\r\n    has(\"entrance\") ||\r\n    has(\"outdoor\") ||\r\n    has(\"garden\");\r\n\r\n  // ------------------------------------------------------------\r\n  // üèä Piscina\r\n  // ------------------------------------------------------------\r\n  if (has(\"pool\")) weights.push({ key: \"pool\", weight: 1.0 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üíÜ Spa / Wellness\r\n  // ------------------------------------------------------------\r\n  if (has(\"spa\")) weights.push({ key: \"spa\", weight: 1.0 });\r\n  if (has(\"sauna\")) weights.push({ key: \"sauna\", weight: 0.9 });\r\n  if (has(\"hammam\")) weights.push({ key: \"hammam\", weight: 0.9 });\r\n  if (has(\"steam\")) weights.push({ key: \"steam\", weight: 0.8 });\r\n  if (has(\"massage\")) weights.push({ key: \"massage\", weight: 1.0 });\r\n  if (has(\"wellness\")) weights.push({ key: \"wellness\", weight: 0.9 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üåä Vistas\r\n  // ------------------------------------------------------------\r\n  if (has(\"view\")) weights.push({ key: \"view\", weight: 0.9 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üåÖ Ambiente\r\n  // ------------------------------------------------------------\r\n  if (has(\"sunset\")) weights.push({ key: \"sunset\", weight: 0.8 });\r\n  if (has(\"night\")) weights.push({ key: \"night\", weight: 0.7 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üçΩÔ∏è Restaurante\r\n  // ------------------------------------------------------------\r\n  if (has(\"restaurant\")) weights.push({ key: \"restaurant\", weight: 0.9 });\r\n  if (has(\"buffet\")) weights.push({ key: \"buffet\", weight: 0.8 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üç∏ Bar\r\n  // ------------------------------------------------------------\r\n  if (has(\"bar\")) weights.push({ key: \"bar\", weight: 0.8 });\r\n  if (has(\"rooftop\")) weights.push({ key: \"rooftop\", weight: 0.9 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üõèÔ∏è Habitaciones (ya no bloqueadas por \"view\")\r\n  // ------------------------------------------------------------\r\n  if (has(\"room\") || has(\"suite\")) {\r\n    weights.push({ key: \"room\", weight: 1.0 });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üõãÔ∏è Zonas comunes\r\n  // ------------------------------------------------------------\r\n  if (has(\"lobby\")) weights.push({ key: \"lobby\", weight: 0.9 });\r\n  if (has(\"meeting\")) weights.push({ key: \"meeting_room\", weight: 0.8 });\r\n\r\n  // ------------------------------------------------------------\r\n  // üå¥ Exterior\r\n  // ------------------------------------------------------------\r\n  if (has(\"facade\")) weights.push({ key: \"facade\", weight: 0.95 });\r\n  if (has(\"terrace\")) weights.push({ key: \"terrace\", weight: 0.8 });\r\n  if (has(\"balcony\")) weights.push({ key: \"balcony\", weight: 0.7 });\r\n\r\n  // ------------------------------------------------------------\r\n  // Ordenar por peso\r\n  // ------------------------------------------------------------\r\n  weights.sort((a, b) => b.weight - a.weight);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê CORRECCI√ìN INTELIGENTE\r\n  // Si hay exterior + habitaci√≥n ‚Üí gana habitaci√≥n (no exterior)\r\n  // ------------------------------------------------------------\r\n  const hasRoom = normalized.includes(\"room\") || normalized.includes(\"suite\");\r\n\r\n  if (isExterior && hasRoom) {\r\n    return {\r\n      scene: \"habitaciones\",\r\n      elements: weights\r\n    };\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Escena dominante normal\r\n  // ------------------------------------------------------------\r\n  const scene =\r\n    weights.length > 0 ? detectSceneFromWeights(weights[0].key) : \"otros\";\r\n\r\n  return { scene, elements: weights };\r\n}\r\n\r\nfunction detectSceneFromWeights(key: string): string {\r\n  if (key.includes(\"pool\")) return \"piscina\";\r\n  if (key.includes(\"spa\") || key.includes(\"massage\") || key.includes(\"hammam\")) return \"spa\";\r\n  if (key.includes(\"restaurant\") || key.includes(\"buffet\")) return \"restaurante\";\r\n  if (key.includes(\"bar\") || key.includes(\"rooftop\")) return \"bar\";\r\n  if (key.includes(\"room\") || key.includes(\"suite\")) return \"habitaciones\";\r\n  if (key.includes(\"lobby\") || key.includes(\"meeting\")) return \"salas_comunes\";\r\n  if (key.includes(\"facade\")) return \"exterior\";\r\n  if (key.includes(\"view\")) return \"vistas\";\r\n  if (key.includes(\"terrace\") || key.includes(\"balcony\")) return \"terraza\";\r\n  return \"otros\";\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 728, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/supabaseClient.ts"],"sourcesContent":["// src/lib/supabaseClient.ts\r\n\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\n// ------------------------------------------------------------\r\n// ‚≠ê Validaci√≥n estricta de variables de entorno\r\n// ------------------------------------------------------------\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (\r\n  !supabaseUrl ||\r\n  !supabaseAnonKey ||\r\n  supabaseUrl === \"undefined\" ||\r\n  supabaseAnonKey === \"undefined\" ||\r\n  supabaseUrl === \"null\" ||\r\n  supabaseAnonKey === \"null\"\r\n) {\r\n  throw new Error(\r\n    \"‚ùå Supabase environment variables are missing or invalid. Check NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.\"\r\n  );\r\n}\r\n\r\n// ------------------------------------------------------------\r\n// ‚≠ê Crear cliente Supabase (modo frontend con sesi√≥n persistente)\r\n// ------------------------------------------------------------\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\r\n  auth: {\r\n    persistSession: true,        // ‚Üê NECESARIO para login\r\n    autoRefreshToken: true,      // ‚Üê refresca tokens autom√°ticamente\r\n    detectSessionInUrl: true,    // ‚Üê necesario para magic links / OAuth\r\n  },\r\n});\r\n\r\n// ------------------------------------------------------------\r\n// (Opcional) Log controlado solo en desarrollo\r\n// ------------------------------------------------------------\r\nif (process.env.NODE_ENV === \"development\") {\r\n  console.log(\"üîå Supabase client initialized\");\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,4BAA4B;AAE5B;;AAEA,+DAA+D;AAC/D,gDAAgD;AAChD,+DAA+D;AAC/D,MAAM;AACN,MAAM;AAEN;;AAgBO,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa,iBAAiB;IACjE,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;QAClB,oBAAoB;IACtB;AACF;AAEA,+DAA+D;AAC/D,+CAA+C;AAC/C,+DAA+D;AAC/D,wCAA4C;IAC1C,QAAQ,GAAG,CAAC;AACd"}},
    {"offset": {"line": 759, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/aiTitleTemplates.ts"],"sourcesContent":["// src/lib/aiTitleTemplates.ts\r\n\r\nexport const TITLE_TEMPLATES = {\r\n  // ============================\r\n  // üü¶ PISCINA\r\n  // ============================\r\n  piscina: [\r\n    { es: \"Piscina exterior al atardecer\", en: \"Outdoor pool at sunset\" },\r\n    { es: \"Piscina con vistas al mar\", en: \"Pool with sea view\" },\r\n    { es: \"Piscina interior climatizada\", en: \"Indoor heated pool\" },\r\n    { es: \"Piscina rodeada de jardines\", en: \"Pool surrounded by gardens\" },\r\n    { es: \"Piscina con tumbonas modernas\", en: \"Pool with modern loungers\" },\r\n    { es: \"Piscina iluminada por la noche\", en: \"Pool illuminated at night\" },\r\n    { es: \"Piscina infinita con vistas\", en: \"Infinity pool with views\" },\r\n    { es: \"Piscina exterior con palmeras\", en: \"Outdoor pool with palm trees\" },\r\n    { es: \"Piscina junto a zona lounge\", en: \"Pool next to lounge area\" },\r\n    { es: \"Piscina con agua cristalina\", en: \"Pool with crystal clear water\" },\r\n\r\n    // ‚≠ê COMBINADOS PISCINA + EXTERIOR\r\n    { es: \"Piscina frente a la fachada del hotel\", en: \"Pool in front of the hotel facade\" },\r\n    { es: \"Piscina con vistas al mar y al hotel\", en: \"Pool with sea view and hotel building\" },\r\n    { es: \"Piscina junto a la fachada iluminada\", en: \"Pool next to illuminated hotel facade\" },\r\n    { es: \"Piscina exterior con palmeras y hotel\", en: \"Outdoor pool with palm trees and hotel\" },\r\n    { es: \"Piscina con vistas al mar y palmeras\", en: \"Pool with sea view and palm trees\" },\r\n    { es: \"Piscina frente al hotel con vistas al mar\", en: \"Pool in front of hotel with sea view\" },\r\n    { es: \"Piscina exterior con vistas al oc√©ano\", en: \"Outdoor pool with ocean view\" },\r\n    { es: \"Piscina junto a terraza con vistas\", en: \"Pool next to terrace with views\" },\r\n    { es: \"Piscina exterior con ambiente tropical\", en: \"Outdoor pool with tropical ambience\" },\r\n    { es: \"Piscina con vistas al mar y zona exterior\", en: \"Pool with sea view and outdoor area\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü© EXTERIOR / FACHADA\r\n  // ============================\r\n  exterior: [\r\n    { es: \"Fachada del hotel iluminada\", en: \"Illuminated hotel facade\" },\r\n    { es: \"Entrada exterior moderna\", en: \"Modern exterior entrance\" },\r\n    { es: \"Zona exterior ajardinada\", en: \"Garden outdoor area\" },\r\n    { es: \"Terraza con vistas panor√°micas\", en: \"Terrace with panoramic views\" },\r\n    { es: \"Exterior del hotel al atardecer\", en: \"Hotel exterior at sunset\" },\r\n    { es: \"Entrada principal elegante\", en: \"Elegant main entrance\" },\r\n    { es: \"Jardines exteriores cuidados\", en: \"Well-kept outdoor gardens\" },\r\n    { es: \"Zona exterior con palmeras\", en: \"Outdoor area with palm trees\" },\r\n    { es: \"Fachada contempor√°nea del hotel\", en: \"Contemporary hotel facade\" },\r\n    { es: \"Acceso exterior con iluminaci√≥n c√°lida\", en: \"Exterior access with warm lighting\" },\r\n\r\n    // ‚≠ê COMBINADOS EXTERIOR + PISCINA\r\n    { es: \"Fachada del hotel con piscina exterior\", en: \"Hotel facade with outdoor pool\" },\r\n    { es: \"Hotel con piscina y vistas al mar\", en: \"Hotel with pool and sea view\" },\r\n    { es: \"Fachada del hotel frente a la piscina\", en: \"Hotel facade facing the pool\" },\r\n    { es: \"Zona exterior con piscina y palmeras\", en: \"Outdoor area with pool and palm trees\" },\r\n    { es: \"Hotel con piscina iluminada al atardecer\", en: \"Hotel with illuminated pool at sunset\" },\r\n    { es: \"Hotel con piscina y ambiente tropical\", en: \"Hotel with pool and tropical ambience\" },\r\n    { es: \"Fachada del hotel con piscina y terraza\", en: \"Hotel facade with pool and terrace\" },\r\n    { es: \"Hotel con piscina y vistas al oc√©ano\", en: \"Hotel with pool and ocean view\" },\r\n    { es: \"Zona exterior del hotel con piscina\", en: \"Hotel outdoor area with pool\" },\r\n    { es: \"Hotel con piscina y jardines exteriores\", en: \"Hotel with pool and outdoor gardens\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üüß HABITACIONES\r\n  // ============================\r\n  habitaciones: [\r\n    { es: \"Habitaci√≥n doble luminosa\", en: \"Bright double room\" },\r\n    { es: \"Habitaci√≥n con vistas al mar\", en: \"Room with sea view\" },\r\n    { es: \"Habitaci√≥n moderna y acogedora\", en: \"Modern and cozy room\" },\r\n    { es: \"Suite amplia con decoraci√≥n elegante\", en: \"Spacious suite with elegant decor\" },\r\n    { es: \"Habitaci√≥n con balc√≥n privado\", en: \"Room with private balcony\" },\r\n    { es: \"Dormitorio con luz natural\", en: \"Bedroom with natural light\" },\r\n    { es: \"Habitaci√≥n minimalista y moderna\", en: \"Minimalist modern room\" },\r\n    { es: \"Suite con zona de estar\", en: \"Suite with living area\" },\r\n    { es: \"Habitaci√≥n con cama king-size\", en: \"Room with king-size bed\" },\r\n    { es: \"Habitaci√≥n decorada con tonos c√°lidos\", en: \"Room decorated with warm tones\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü™ SPA\r\n  // ============================\r\n  spa: [\r\n    { es: \"Spa con iluminaci√≥n relajante\", en: \"Spa with relaxing lighting\" },\r\n    { es: \"Spa moderno con ambiente c√°lido\", en: \"Modern spa with warm ambience\" },\r\n    { es: \"Zona de spa con luz tenue\", en: \"Spa area with soft lighting\" },\r\n    { es: \"Spa elegante con decoraci√≥n natural\", en: \"Elegant spa with natural decor\" },\r\n    { es: \"Spa con jacuzzi iluminado\", en: \"Spa with illuminated jacuzzi\" },\r\n    { es: \"Zona de masajes con luz suave\", en: \"Massage area with soft light\" },\r\n    { es: \"Spa con ambiente zen\", en: \"Spa with zen ambience\" },\r\n    { es: \"Spa con piscina climatizada\", en: \"Spa with heated pool\" },\r\n    { es: \"Spa con decoraci√≥n en madera\", en: \"Spa with wooden decor\" },\r\n    { es: \"Spa con velas y ambiente √≠ntimo\", en: \"Spa with candles and intimate ambience\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü® RESTAURANTE\r\n  // ============================\r\n  restaurante: [\r\n    { es: \"Restaurante elegante y moderno\", en: \"Elegant modern restaurant\" },\r\n    { es: \"Restaurante con decoraci√≥n cl√°sica\", en: \"Restaurant with classic decor\" },\r\n    { es: \"Restaurante luminoso y acogedor\", en: \"Bright and cozy restaurant\" },\r\n    { es: \"Restaurante con mesas bien dispuestas\", en: \"Restaurant with well-arranged tables\" },\r\n    { es: \"Restaurante con iluminaci√≥n c√°lida\", en: \"Restaurant with warm lighting\" },\r\n    { es: \"Restaurante con ambiente sofisticado\", en: \"Restaurant with sophisticated ambience\" },\r\n    { es: \"Restaurante con decoraci√≥n contempor√°nea\", en: \"Restaurant with contemporary decor\" },\r\n    { es: \"Restaurante con vistas exteriores\", en: \"Restaurant with outdoor views\" },\r\n    { es: \"Restaurante con mesas de madera\", en: \"Restaurant with wooden tables\" },\r\n    { es: \"Restaurante con estilo minimalista\", en: \"Minimalist style restaurant\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü´ INTERIOR\r\n  // ============================\r\n  interior: [\r\n    { es: \"Interior moderno y luminoso\", en: \"Modern bright interior\" },\r\n    { es: \"Zona interior con decoraci√≥n elegante\", en: \"Interior area with elegant decor\" },\r\n    { es: \"Espacio interior acogedor\", en: \"Cozy interior space\" },\r\n    { es: \"Pasillo interior iluminado\", en: \"Illuminated interior hallway\" },\r\n    { es: \"Zona interior con mobiliario moderno\", en: \"Interior with modern furniture\" },\r\n    { es: \"Interior con detalles en madera\", en: \"Interior with wooden details\" },\r\n    { es: \"Espacio interior minimalista\", en: \"Minimalist interior space\" },\r\n    { es: \"Zona interior amplia y di√°fana\", en: \"Wide open interior area\" },\r\n    { es: \"Interior con iluminaci√≥n c√°lida\", en: \"Interior with warm lighting\" },\r\n    { es: \"Vest√≠bulo interior elegante\", en: \"Elegant interior lobby\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü¶ SALAS COMUNES\r\n  // ============================\r\n  salas_comunes: [\r\n    { es: \"Sala com√∫n moderna y acogedora\", en: \"Modern cozy common room\" },\r\n    { es: \"Zona com√∫n con sof√°s c√≥modos\", en: \"Common area with comfortable sofas\" },\r\n    { es: \"Sala de estar amplia y luminosa\", en: \"Bright spacious living room\" },\r\n    { es: \"Espacio com√∫n con decoraci√≥n elegante\", en: \"Common space with elegant decor\" },\r\n    { es: \"Sala com√∫n con luz natural\", en: \"Common room with natural light\" },\r\n    { es: \"Zona lounge moderna\", en: \"Modern lounge area\" },\r\n    { es: \"Sala com√∫n con mobiliario contempor√°neo\", en: \"Common room with contemporary furniture\" },\r\n    { es: \"Espacio compartido con ambiente relajado\", en: \"Shared space with relaxed ambience\" },\r\n    { es: \"Sala com√∫n con vistas exteriores\", en: \"Common room with outdoor views\" },\r\n    { es: \"Zona com√∫n con decoraci√≥n minimalista\", en: \"Minimalist common area\" },\r\n  ],\r\n\r\n  // ============================\r\n  // üü´ OTROS\r\n  // ============================\r\n  otros: [\r\n    { es: \"Espacio del hotel\", en: \"Hotel space\" },\r\n    { es: \"Zona del hotel\", en: \"Hotel area\" },\r\n    { es: \"√Årea del hotel bien iluminada\", en: \"Well-lit hotel area\" },\r\n    { es: \"Zona del hotel con decoraci√≥n moderna\", en: \"Hotel area with modern decor\" },\r\n    { es: \"Espacio funcional del hotel\", en: \"Functional hotel space\" },\r\n    { es: \"√Årea del hotel con luz natural\", en: \"Hotel area with natural light\" },\r\n  ],\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1196, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/generateDynamicTitles.ts"],"sourcesContent":["// src/lib/generateDynamicTitles.ts\r\n\r\n/**\r\n * Genera t√≠tulos din√°micos basados en tags ya normalizados.\r\n * Compatible con normalizeTags(), categoryMap y sceneWeights.\r\n */\r\n\r\nexport function generateDynamicTitles(tags: string[]) {\r\n  const normalized = tags.map(t => t.toLowerCase());\r\n  const has = (key: string) => normalized.includes(key);\r\n\r\n  // -----------------------------\r\n  // TAGS PRINCIPALES (ya normalizados)\r\n  // -----------------------------\r\n  const hasPool = has(\"pool\");\r\n  const hasSpa = has(\"spa\");\r\n  const hasSauna = has(\"sauna\") || has(\"steam\") || has(\"hammam\");\r\n  const hasMassage = has(\"massage\") || has(\"wellness\") || has(\"treatment\");\r\n\r\n  const hasView = has(\"view\");\r\n  const hasSea = has(\"sea\") || has(\"ocean\");\r\n  const hasCity = has(\"city\") || has(\"skyline\");\r\n  const hasMountain = has(\"mountain\");\r\n\r\n  const hasTerrace = has(\"terrace\") || has(\"balcony\") || has(\"rooftop\");\r\n\r\n  const hasRestaurant = has(\"restaurant\") || has(\"buffet\") || has(\"dining\");\r\n  const hasBar = has(\"bar\") || has(\"cocktail\") || has(\"rooftop\");\r\n\r\n  const hasRoom = has(\"room\") || has(\"suite\");\r\n\r\n  const hasLobby = has(\"lobby\") || has(\"reception\");\r\n  const hasLounge = has(\"lounge\") || has(\"common area\");\r\n  const hasMeeting = has(\"meeting\") || has(\"conference\");\r\n  const hasCoworking = has(\"coworking\");\r\n  const hasKidsClub = has(\"kids club\");\r\n\r\n  const hasFacade = has(\"facade\") || has(\"building\") || has(\"entrance\");\r\n  const hasExterior = has(\"exterior\") || has(\"outdoor\") || has(\"garden\");\r\n\r\n  const titles: string[] = [];\r\n\r\n  // ------------------------------------------------------------\r\n  // üèä PISCINA\r\n  // ------------------------------------------------------------\r\n  if (hasPool) {\r\n    if (hasView && hasSea) {\r\n      titles.push(\"Piscina exterior con vistas al mar\");\r\n      titles.push(\"Piscina del hotel frente al oc√©ano\");\r\n    }\r\n\r\n    if (hasTerrace) {\r\n      titles.push(\"Piscina junto a terraza con vistas\");\r\n    }\r\n\r\n    titles.push(\"Piscina exterior del hotel\");\r\n    titles.push(\"Piscina del hotel\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üíÜ SPA / WELLNESS\r\n  // ------------------------------------------------------------\r\n  if (hasSpa || hasMassage) {\r\n    titles.push(\"Sala de masajes con camillas preparadas\");\r\n    titles.push(\"Zona de spa con ambiente relajante\");\r\n    titles.push(\"Espacio de bienestar con camillas de masaje\");\r\n\r\n    if (hasSauna) titles.push(\"Spa con sauna y zona de relajaci√≥n\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üçΩÔ∏è RESTAURANTE\r\n  // ------------------------------------------------------------\r\n  if (hasRestaurant) {\r\n    if (hasSea) titles.push(\"Restaurante con vistas al mar\");\r\n    if (hasTerrace) titles.push(\"Restaurante con terraza exterior\");\r\n    if (hasView) titles.push(\"Restaurante con vistas panor√°micas\");\r\n\r\n    titles.push(\"Restaurante elegante del hotel\");\r\n    titles.push(\"Buffet del hotel\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üç∏ BAR\r\n  // ------------------------------------------------------------\r\n  if (hasBar) {\r\n    if (hasCity) titles.push(\"Rooftop bar con vistas a la ciudad\");\r\n    if (hasView) titles.push(\"Bar con vistas panor√°micas\");\r\n\r\n    titles.push(\"Bar del hotel con ambiente moderno\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üõèÔ∏è HABITACIONES\r\n  // ------------------------------------------------------------\r\n  if (hasRoom) {\r\n    if (hasView && hasSea) titles.push(\"Habitaci√≥n con vistas al mar\");\r\n    if (hasView && hasCity) titles.push(\"Habitaci√≥n con vistas a la ciudad\");\r\n    if (hasTerrace) titles.push(\"Habitaci√≥n con balc√≥n privado\");\r\n\r\n    titles.push(\"Habitaci√≥n moderna y luminosa\");\r\n    titles.push(\"Suite elegante del hotel\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // üõãÔ∏è ZONAS COMUNES\r\n  // ------------------------------------------------------------\r\n  if (hasLobby) titles.push(\"Lobby moderno del hotel\");\r\n  if (hasLounge) titles.push(\"Zona com√∫n con ambiente acogedor\");\r\n  if (hasCoworking) titles.push(\"Zona coworking del hotel\");\r\n  if (hasMeeting) titles.push(\"Sala de reuniones moderna\");\r\n  if (hasKidsClub) titles.push(\"Kids club del hotel\");\r\n\r\n  // ------------------------------------------------------------\r\n  // üè¢ FACHADA / EXTERIOR\r\n  // ------------------------------------------------------------\r\n  if (hasFacade) {\r\n    if (hasSea) titles.push(\"Fachada del hotel con vistas al mar\");\r\n    titles.push(\"Fachada exterior del hotel\");\r\n  }\r\n\r\n  if (hasExterior) {\r\n    titles.push(\"Zona exterior del hotel\");\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // FALLBACK\r\n  // ------------------------------------------------------------\r\n  if (titles.length === 0) {\r\n    titles.push(\"Zona del hotel\");\r\n  }\r\n\r\n  return titles;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1311, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/generateAiTitleV2.ts"],"sourcesContent":["// src/lib/generateAiTitleV2.ts\r\n\r\nimport { TITLE_TEMPLATES } from \"./aiTitleTemplates\";\r\nimport { generateDynamicTitles } from \"./generateDynamicTitles\";\r\nimport { computeSceneWeights } from \"./sceneWeights\";\r\nimport { normalizeTags } from \"./normalizeTags\";\r\n\r\nconst CLIP_API_URL =\r\n  process.env.NEXT_PUBLIC_CLIP_URL || \"http://localhost:8000/rank\";\r\n\r\n/**\r\n * Motor principal de generaci√≥n de t√≠tulos:\r\n * 1. Normaliza tags\r\n * 2. Detecta escena (sceneWeights)\r\n * 3. Genera t√≠tulos din√°micos\r\n * 4. Mezcla plantillas fijas + din√°micos\r\n * 5. Env√≠a candidatos a CLIP /rank con similitud imagen‚Äìtexto\r\n * 6. Devuelve el mejor t√≠tulo en espa√±ol\r\n */\r\nexport async function generateAiTitleFromClip(\r\n  imageUrl: string,\r\n  category?: string | null,\r\n  tags?: any[]\r\n) {\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 1. Normalizar tags\r\n  // ------------------------------------------------------------\r\n  const normalizedTags = normalizeTags(tags || []);\r\n  console.log(\"üîß Normalized tags:\", normalizedTags);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 2. Scene Weighting\r\n  // ------------------------------------------------------------\r\n  const { scene, elements } = computeSceneWeights(normalizedTags);\r\n  const normalizedCategory = (category || \"\").toLowerCase();\r\n\r\n  console.log(\"üéØ Scene detected:\", scene);\r\n  console.log(\"üìä Scene weights:\", elements);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 3. T√≠tulos din√°micos\r\n  // ------------------------------------------------------------\r\n  const dynamicTitles = generateDynamicTitles(normalizedTags);\r\n  console.log(\"üß† Dynamic titles:\", dynamicTitles);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 4. Plantillas seg√∫n escena/categor√≠a\r\n  // ------------------------------------------------------------\r\n  let templates;\r\n\r\n  // Piscina tiene prioridad absoluta\r\n  if (normalizedCategory === \"piscina\" || scene === \"piscina\") {\r\n    templates = [\r\n      ...TITLE_TEMPLATES.piscina,\r\n      ...TITLE_TEMPLATES.exterior // fallback natural\r\n    ];\r\n  }\r\n  // Si existe plantilla para la escena detectada\r\n  else if (TITLE_TEMPLATES[scene]) {\r\n    templates = TITLE_TEMPLATES[scene];\r\n  }\r\n  // Si existe plantilla para la categor√≠a detectada\r\n  else if (TITLE_TEMPLATES[normalizedCategory]) {\r\n    templates = TITLE_TEMPLATES[normalizedCategory];\r\n  }\r\n  // Fallback\r\n  else {\r\n    templates = TITLE_TEMPLATES[\"otros\"];\r\n  }\r\n\r\n  const templateSpanish = templates.map(t => t.es);\r\n  const templateEnglish = templates.map(t => t.en);\r\n\r\n  console.log(\"üìö Template Spanish:\", templateSpanish);\r\n  console.log(\"üìö Template English:\", templateEnglish);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 5. Fusionar din√°micos + plantillas\r\n  // ------------------------------------------------------------\r\n  const spanishCandidates = [...dynamicTitles, ...templateSpanish];\r\n\r\n  const englishCandidates = [\r\n    ...dynamicTitles.map(t => translateToEnglish(t)),\r\n    ...templateEnglish\r\n  ];\r\n\r\n  console.log(\"üá™üá∏ Final Spanish candidates:\", spanishCandidates);\r\n  console.log(\"üá¨üáß Final English candidates:\", englishCandidates);\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 6. Llamar a CLIP /rank con similitud imagen‚Äìtexto\r\n  // ------------------------------------------------------------\r\n  const res = await fetch(CLIP_API_URL, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      titles: englishCandidates,\r\n      tags: normalizedTags,\r\n      scene,\r\n      category: normalizedCategory,\r\n      image_url: imageUrl, // üëà NUEVO: similitud real imagen‚Äìtexto\r\n    }),\r\n  });\r\n\r\n  if (!res.ok) {\r\n    console.error(\"‚ùå Error llamando a CLIP /rank:\", await res.text());\r\n    return spanishCandidates[0];\r\n  }\r\n\r\n  const ranked = await res.json();\r\n  console.log(\"üèÜ CLIP ranking:\", ranked);\r\n\r\n  const bestEnglish = ranked?.ranked?.[0];\r\n  if (!bestEnglish) return spanishCandidates[0];\r\n\r\n  // ------------------------------------------------------------\r\n  // ‚≠ê 7. Buscar equivalente en espa√±ol\r\n  // ------------------------------------------------------------\r\n  const templateMatch = templates.find(t => t.en === bestEnglish);\r\n  if (templateMatch) {\r\n    console.log(\"‚ú® Best match (template):\", templateMatch.es);\r\n    return templateMatch.es;\r\n  }\r\n\r\n  const index = englishCandidates.indexOf(bestEnglish);\r\n  console.log(\"‚ú® Best match (dynamic):\", spanishCandidates[index]);\r\n\r\n  return spanishCandidates[index] || spanishCandidates[0];\r\n}\r\n\r\n// ------------------------------------------------------------\r\n// ‚≠ê Traducci√≥n ES ‚Üí EN (simple pero suficiente para CLIP ranking)\r\n// ------------------------------------------------------------\r\nfunction translateToEnglish(spanish: string): string {\r\n  let en = spanish.toLowerCase();\r\n  en = en.replace(/\\s+/g, \" \").trim();\r\n  return en.charAt(0).toUpperCase() + en.slice(1);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1425, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/lib/updateMediaAiTitle.ts"],"sourcesContent":["// src/lib/updateMediaAiTitle.ts\r\n\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\nimport { generateAiTitleFromClip } from \"./generateAiTitleV2\";\r\n\r\n/**\r\n * Actualiza el campo ai_title de una imagen en la tabla media\r\n */\r\nexport async function updateMediaAiTitle(\r\n  mediaId: string,\r\n  imageUrl: string,\r\n  category?: string | null,\r\n  tags?: any[]\r\n) {\r\n  try {\r\n    console.log(\"üß† Generando t√≠tulo con CLIP para:\", imageUrl);\r\n    console.log(\"üè∑Ô∏è Tags recibidos (raw):\", tags);\r\n\r\n    // ‚≠ê NORMALIZACI√ìN SEGURA Y CORRECTA\r\n    const safeTags =\r\n      Array.isArray(tags) && tags.length > 0\r\n        ? tags\r\n            .map(t => {\r\n              if (typeof t === \"string\") return t.trim();\r\n              if (typeof t === \"object\" && t?.label) return t.label.trim();\r\n              return null;\r\n            })\r\n            .filter(Boolean)\r\n        : [];\r\n\r\n    console.log(\"üè∑Ô∏è Tags usados para CLIP:\", safeTags);\r\n\r\n    // ‚≠ê Pasamos tags limpios al generador\r\n    const ai_title = await generateAiTitleFromClip(\r\n      imageUrl,\r\n      category,\r\n      safeTags\r\n    );\r\n\r\n    console.log(\"üè∑Ô∏è T√≠tulo generado:\", ai_title);\r\n\r\n    const { error } = await supabase\r\n      .from(\"media\")\r\n      .update({ ai_title })\r\n      .eq(\"id\", mediaId);\r\n\r\n    if (error) {\r\n      console.error(\"‚ùå Error actualizando ai_title:\", error);\r\n      return null;\r\n    }\r\n\r\n    console.log(`‚úÖ ai_title actualizado para media ${mediaId}`);\r\n    return ai_title;\r\n  } catch (err) {\r\n    console.error(\"‚ùå Error en updateMediaAiTitle:\", err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,gCAAgC;AAEhC;AACA;;;AAKO,eAAe,mBACpB,OAAe,EACf,QAAgB,EAChB,QAAwB,EACxB,IAAY;IAEZ,IAAI;QACF,QAAQ,GAAG,CAAC,sCAAsC;QAClD,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,oCAAoC;QACpC,MAAM,WACJ,MAAM,OAAO,CAAC,SAAS,KAAK,MAAM,GAAG,IACjC,KACG,GAAG,CAAC,CAAA;YACH,IAAI,OAAO,MAAM,UAAU,OAAO,EAAE,IAAI;YACxC,IAAI,OAAO,MAAM,YAAY,GAAG,OAAO,OAAO,EAAE,KAAK,CAAC,IAAI;YAC1D,OAAO;QACT,GACC,MAAM,CAAC,WACV,EAAE;QAER,QAAQ,GAAG,CAAC,8BAA8B;QAE1C,sCAAsC;QACtC,MAAM,WAAW,MAAM,IAAA,4JAAuB,EAC5C,UACA,UACA;QAGF,QAAQ,GAAG,CAAC,wBAAwB;QAEpC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,0IAAQ,CAC7B,IAAI,CAAC,SACL,MAAM,CAAC;YAAE;QAAS,GAClB,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,kCAAkC;YAChD,OAAO;QACT;QAEA,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,SAAS;QAC1D,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;IACT;AACF"}},
    {"offset": {"line": 1466, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/achra/proyectos/app-hotel-nueva/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport { Buffer } from 'buffer';\r\nimport crypto from 'crypto';\r\nimport sharp from 'sharp';\r\n\r\nimport { analyzeImage } from '@/lib/ai';\r\nimport { normalizeTags } from '@/lib/normalizeTags';\r\nimport { detectCategory } from '@/utils/categoryMap';\r\nimport { detectScenePriority } from '@/lib/scenePriority';\r\nimport { computeSceneWeights } from '@/lib/sceneWeights';\r\n\r\n// ‚≠ê IMPORTANTE: generador de t√≠tulos\r\nimport { updateMediaAiTitle } from '@/lib/updateMediaAiTitle';\r\n\r\n// ==================== VALIDACI√ìN ENV ====================\r\nif (!process.env.CLOUDINARY_CLOUD_NAME) throw new Error('‚ùå CLOUDINARY_CLOUD_NAME no est√° definido');\r\nif (!process.env.CLOUDINARY_API_KEY) throw new Error('‚ùå CLOUDINARY_API_KEY no est√° definido');\r\nif (!process.env.CLOUDINARY_API_SECRET) throw new Error('‚ùå CLOUDINARY_API_SECRET no est√° definido');\r\n\r\ncloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\n// ==================== SUPABASE ====================\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\n// ==================== VERSIONES ====================\r\nconst IMAGE_SIZES = {\r\n  thumbnail: { width: 256, height: 144 },\r\n  small: { width: 800, height: 450 },\r\n  medium: { width: 1920, height: 1080 },\r\n  large: { width: 2880, height: 1620 },\r\n};\r\n\r\nexport async function POST(request: NextRequest) {\r\n  console.log('üöÄ POST /api/upload iniciado');\r\n\r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file') as File | null;\r\n    const hotelId = formData.get('hotel_id') as string | null;\r\n\r\n    console.log('üì• Datos recibidos:', {\r\n      hasFile: !!file,\r\n      hasHotelId: !!hotelId,\r\n      fileType: file?.type,\r\n      fileSize: file?.size,\r\n    });\r\n\r\n    if (!file || !(file instanceof File)) {\r\n      return NextResponse.json({ error: 'Archivo inv√°lido' }, { status: 400 });\r\n    }\r\n\r\n    if (!hotelId) {\r\n      return NextResponse.json({ error: 'Falta hotel_id' }, { status: 400 });\r\n    }\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      return NextResponse.json({ error: 'Archivo demasiado grande (m√°x. 5MB)' }, { status: 400 });\r\n    }\r\n\r\n    // ==================== BUFFER + METADATA ====================\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const buffer = Buffer.from(arrayBuffer);\r\n\r\n    const metadata = await sharp(buffer).metadata();\r\n\r\n    // ==================== HASH ====================\r\n    const hash = crypto.createHash('sha256').update(buffer).digest('hex');\r\n    console.log('üîë Hash generado:', hash.substring(0, 16));\r\n\r\n    // ==================== CHECK DUPLICADO ====================\r\n    const { data: existing, error: checkError } = await supabase\r\n      .from('image_hashes')\r\n      .select('url, type, quality_score')\r\n      .eq('hash', hash)\r\n      .single();\r\n\r\n    if (checkError && checkError.code !== 'PGRST116') {\r\n      console.error('‚ùå Error verificando duplicados:', checkError);\r\n      return NextResponse.json({ error: 'Error verificando duplicados' }, { status: 500 });\r\n    }\r\n\r\n    // ==================== DUPLICADO ====================\r\n    if (existing) {\r\n      console.log('‚ö†Ô∏è Imagen duplicada detectada');\r\n\r\n      const analysis = await analyzeImage(existing.url);\r\n\r\n      const rawTags = analysis.tags;\r\n      const tags = normalizeTags(rawTags);\r\n      const category = detectCategory(tags);\r\n      const scene = detectScenePriority(tags);\r\n      const sceneWeights = computeSceneWeights(tags);\r\n\r\n      console.log('üè∑Ô∏è Tags (premium):', tags);\r\n      console.log('üìÇ Categor√≠a detectada:', category);\r\n      console.log('üé¨ Escena detectada:', scene);\r\n      console.log('‚öñÔ∏è Pesos de escena:', sceneWeights);\r\n\r\n      return NextResponse.json({\r\n        url: existing.url,\r\n        type: existing.type,\r\n        quality_score: existing.quality_score || 0.8,\r\n        is_duplicate: true,\r\n        tags,\r\n        category,\r\n        scene,\r\n        sceneWeights,\r\n        message: 'Esta imagen ya existe en tu galer√≠a',\r\n      });\r\n    }\r\n\r\n    // ==================== UPLOAD CLOUDINARY ====================\r\n    console.log('‚òÅÔ∏è Subiendo a Cloudinary...');\r\n\r\n    const uploadResult = await new Promise<any>((resolve, reject) => {\r\n      cloudinary.uploader\r\n        .upload_stream(\r\n          {\r\n            folder: 'hotel-media',\r\n            resource_type: 'auto',\r\n            invalidate: true,\r\n            quality_analysis: true,\r\n          },\r\n          (error, result) => {\r\n            if (error) reject(error);\r\n            else resolve(result);\r\n          }\r\n        )\r\n        .end(buffer);\r\n    });\r\n\r\n    console.log('‚úÖ Subida exitosa:', uploadResult.secure_url);\r\n\r\n    // ==================== IA ====================\r\n    console.log('üîç Analizando imagen con ExSabri IA...');\r\n    const analysis = await analyzeImage(uploadResult.secure_url);\r\n\r\n    console.log(\"üî• RAW TAGS FROM BACKEND:\", analysis.tags);\r\n\r\n    const rawTags = analysis.tags;\r\n\r\n    // ‚≠ê NORMALIZACI√ìN PREMIUM\r\n    const tags = normalizeTags(rawTags);\r\n\r\n    // ‚≠ê CATEGOR√çA FINAL\r\n    const category = detectCategory(tags);\r\n\r\n    // ‚≠ê ESCENA DOMINANTE\r\n    const scene = detectScenePriority(tags);\r\n\r\n    // ‚≠ê PESOS DE ESCENA\r\n    const sceneWeights = computeSceneWeights(tags);\r\n\r\n    console.log('üè∑Ô∏è Tags (premium):', tags);\r\n    console.log('üìÇ Categor√≠a detectada:', category);\r\n    console.log('üé¨ Escena detectada:', scene);\r\n    console.log('‚öñÔ∏è Pesos de escena:', sceneWeights);\r\n\r\n    const qualityScore = uploadResult.quality_analysis?.focus || 0.8;\r\n\r\n    // ==================== GENERAR VERSIONES ====================\r\n    console.log('üîÑ Generando versiones de imagen...');\r\n\r\n    const versions: Record<string, any> = {};\r\n\r\n    versions.original = {\r\n      url: uploadResult.secure_url,\r\n      dimensions: `${metadata.width}x${metadata.height}`,\r\n      aspect_ratio:\r\n        metadata.width && metadata.height ? `${metadata.width}:${metadata.height}` : 'N/A',\r\n      file_size: `${(buffer.length / 1024).toFixed(1)}KB`,\r\n    };\r\n\r\n    for (const [sizeName, sizeConfig] of Object.entries(IMAGE_SIZES)) {\r\n      try {\r\n        console.log(`  üì∏ Procesando versi√≥n ${sizeName}...`);\r\n\r\n        const processedBuffer = await sharp(buffer)\r\n          .resize(sizeConfig.width, sizeConfig.height, {\r\n            fit: 'inside',\r\n            withoutEnlargement: true,\r\n          })\r\n          .jpeg({ quality: sizeName === 'thumbnail' ? 70 : 85 })\r\n          .toBuffer();\r\n\r\n        const versionUploadResult = await new Promise<any>((resolve, reject) => {\r\n          cloudinary.uploader\r\n            .upload_stream(\r\n              {\r\n                folder: 'hotel-media/versions',\r\n                resource_type: 'image',\r\n                invalidate: true,\r\n                public_id: `${sizeName}-${hash.substring(0, 16)}`,\r\n              },\r\n              (error, result) => {\r\n                if (error) reject(error);\r\n                else resolve(result);\r\n              }\r\n            )\r\n            .end(processedBuffer);\r\n        });\r\n\r\n        const versionMetadata = await sharp(processedBuffer).metadata();\r\n\r\n        versions[sizeName] = {\r\n          url: versionUploadResult.secure_url,\r\n          dimensions: `${versionMetadata.width}x${versionMetadata.height}`,\r\n          aspect_ratio:\r\n            versionMetadata.width && versionMetadata.height\r\n              ? `${versionMetadata.width}:${versionMetadata.height}`\r\n              : 'N/A',\r\n          file_size: `${(processedBuffer.length / 1024).toFixed(1)}KB`,\r\n        };\r\n\r\n        console.log(`  ‚úÖ Versi√≥n ${sizeName} generada: ${versionUploadResult.secure_url}`);\r\n      } catch (error) {\r\n        console.error(`  ‚ùå Error procesando ${sizeName}:`, error);\r\n        versions[sizeName] = versions.original;\r\n      }\r\n    }\r\n\r\n    console.log('‚úÖ Todas las versiones generadas');\r\n\r\n    // ==================== GUARDAR HASH ====================\r\n    const { error: insertHashError } = await supabase.from('image_hashes').insert({\r\n      hash,\r\n      url: uploadResult.secure_url,\r\n      type: uploadResult.resource_type,\r\n      quality_score: qualityScore,\r\n    });\r\n\r\n    if (insertHashError) {\r\n      console.error('‚ùå Error guardando hash:', insertHashError);\r\n    } else {\r\n      console.log('‚úÖ Hash guardado');\r\n    }\r\n\r\n    // ==================== GUARDAR MEDIA ====================\r\n    console.log('üíæ Guardando imagen en tabla media...');\r\n\r\n    const { data: photoData, error: photoError } = await supabase\r\n      .from('media')\r\n      .insert([\r\n        {\r\n          hotel_id: hotelId,\r\n          url: uploadResult.secure_url,\r\n\r\n          // ‚≠ê TAGS NORMALIZADOS\r\n          tags,\r\n\r\n          // ‚≠ê GUARDAMOS RAW TAGS COMO CONFIDENCE SCORES\r\n          confidence_scores: rawTags,\r\n\r\n          quality_score: qualityScore,\r\n          hash,\r\n          category,\r\n          scene,\r\n\r\n          // ‚≠ê GUARDAMOS PESOS COMO JSON SEGURO\r\n          scene_weights: sceneWeights,\r\n\r\n          versions: JSON.stringify(versions),\r\n        },\r\n      ])\r\n      .select();\r\n\r\n    if (photoError) {\r\n      console.error('‚ùå Error guardando foto:', photoError);\r\n      throw new Error('Error al guardar foto en base de datos');\r\n    }\r\n\r\n    console.log('‚úÖ Foto guardada con ID:', photoData?.[0]?.id);\r\n\r\n    // ‚≠ê GENERAR T√çTULO AUTOM√ÅTICO CON CLIP\r\n    try {\r\n      console.log(\"üß† Generando t√≠tulo autom√°tico con CLIP...\");\r\n\r\n      await updateMediaAiTitle(\r\n        photoData[0].id,\r\n        uploadResult.secure_url,\r\n        category,\r\n        tags\r\n      );\r\n\r\n      console.log(\"‚úÖ T√≠tulo generado y guardado\");\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error generando t√≠tulo autom√°tico:\", err);\r\n    }\r\n\r\n    return NextResponse.json({\r\n      url: uploadResult.secure_url,\r\n      type: uploadResult.resource_type,\r\n      quality_score: qualityScore,\r\n      is_duplicate: false,\r\n      tags,\r\n      category,\r\n      scene,\r\n      sceneWeights,\r\n      photo_id: photoData?.[0]?.id,\r\n      versions,\r\n    });\r\n  } catch (error) {\r\n    console.error('‚ùå Error fatal en API:', error);\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Error interno del servidor',\r\n        details: error instanceof Error ? error.message : String(error),\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}